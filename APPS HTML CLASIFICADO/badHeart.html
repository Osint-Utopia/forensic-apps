<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de presion Arterial</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #332D2D 0%, #E4A11B 100%);
            min-height: 100vh;
            padding: 10px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(151, 183, 191, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.1);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #06b6d4 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
        }

        .nav-tabs {
            display: flex;
            background: linear-gradient(90deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom: 3px solid #e2e8f0;
            box-shadow: inset 0 -1px 0 rgba(0,0,0,0.05);
        }

        .nav-tab {
            flex: 1;
            padding: 18px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #64748b;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #06b6d4);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
            color: #1e40af;
            box-shadow: inset 0 -3px 0 #3b82f6;
        }

        .nav-tab.active::before {
            width: 100%;
        }

        .nav-tab:hover:not(.active) {
            background: rgba(59, 130, 246, 0.05);
            color: #3b82f6;
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
            padding: 35px;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 400px;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(30px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select, textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), 0 10px 25px rgba(0,0,0,0.05);
            background: white;
            transform: translateY(-2px);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-right: 12px;
            margin-bottom: 12px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(239, 68, 68, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(102, 126, 234, 0.4);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 0.95em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
        }

        .chart-container {
            position: relative;
            height: 450px;
            margin-bottom: 35px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .readings-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .readings-table th,
        .readings-table td {
            padding: 18px 20px;
            text-align: left;
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .readings-table th {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            font-weight: 700;
            color: #374151;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .readings-table tbody tr {
            transition: all 0.2s ease;
        }

        .readings-table tbody tr:hover {
            background: rgba(59, 130, 246, 0.05);
            transform: scale(1.01);
        }

        .risk-indicator {
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .risk-normal { 
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); 
            color: #166534; 
            box-shadow: 0 2px 8px rgba(22, 101, 52, 0.2);
        }
        .risk-elevated { 
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%); 
            color: #92400e; 
            box-shadow: 0 2px 8px rgba(146, 64, 14, 0.2);
        }
        .risk-stage1 { 
            background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%); 
            color: #991b1b; 
            box-shadow: 0 2px 8px rgba(153, 27, 27, 0.2);
        }
        .risk-stage2 { 
            background: linear-gradient(135deg, #fca5a5 0%, #f87171 100%); 
            color: #7f1d1d; 
            box-shadow: 0 2px 8px rgba(127, 29, 29, 0.3);
        }
        .risk-crisis { 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); 
            color: white; 
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }

        .profile-card {
            background: linear-gradient(135deg, rgba(240, 249, 255, 0.9) 0%, rgba(224, 242, 254, 0.9) 100%);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .recommendations {
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.9) 0%, rgba(241, 245, 249, 0.9) 100%);
            backdrop-filter: blur(20px);
            border-left: 5px solid #3b82f6;
            padding: 30px;
            border-radius: 0 15px 15px 0;
            margin: 25px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
        }

        .alert {
            padding: 20px 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            font-weight: 500;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }

        .alert-success { 
            background: linear-gradient(135deg, rgba(220, 252, 231, 0.9) 0%, rgba(187, 247, 208, 0.9) 100%); 
            color: #166534; 
            border: 1px solid rgba(187, 247, 208, 0.5); 
        }
        .alert-warning { 
            background: linear-gradient(135deg, rgba(254, 243, 199, 0.9) 0%, rgba(253, 230, 138, 0.9) 100%); 
            color: #92400e; 
            border: 1px solid rgba(253, 230, 138, 0.5); 
        }
        .alert-error { 
            background: linear-gradient(135deg, rgba(254, 202, 202, 0.9) 0%, rgba(252, 165, 165, 0.9) 100%); 
            color: #991b1b; 
            border: 1px solid rgba(252, 165, 165, 0.5); 
        }

        /* Mejoras para m√≥vil */
        @media (max-width: 768px) {
            body { 
                padding: 5px; 
            }
            
            .container { 
                margin: 0;
                border-radius: 16px;
                min-height: 100vh;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .nav-tabs { 
                flex-wrap: wrap;
                gap: 2px;
            }
            
            .nav-tab {
                flex: 1 1 calc(50% - 1px);
                font-size: 14px;
                padding: 15px 10px;
                min-width: 120px;
            }
            
            .tab-content {
                padding: 20px 15px;
            }
            
            .form-row { 
                grid-template-columns: 1fr; 
            }
            
            .stats-grid { 
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .stat-card {
                padding: 20px 15px;
            }
            
            .chart-container {
                height: 300px;
                padding: 15px;
            }
            
            .readings-table th,
            .readings-table td {
                padding: 12px 8px;
                font-size: 14px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 14px;
                width: 100%;
                margin-bottom: 10px;
                justify-content: center;
            }
            
            .form-group {
                margin-bottom: 20px;
            }
            
            input, select, textarea {
                padding: 14px 16px;
                font-size: 16px; /* Evita zoom en iOS */
            }
        }

        @media (max-width: 480px) {
            .stats-grid { 
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                flex: 1 1 100%;
                font-size: 13px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .stat-value {
                font-size: 2em;
            }
        }

        /* Animaciones adicionales */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(241, 245, 249, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #2563eb, #0891b2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-heartbeat"></i> Monitor de presion Arterial</h1>
            <p><i class="fas fa-map-marker-alt"></i> Sistema Integral de Control</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('profile')">
                <i class="fas fa-user"></i> Perfil
            </button>
            <button class="nav-tab" onclick="showTab('register')">
                <i class="fas fa-plus-circle"></i> Registrar
            </button>
            <button class="nav-tab" onclick="showTab('dashboard')">
                <i class="fas fa-chart-line"></i> Dashboard
            </button>
            <button class="nav-tab" onclick="showTab('history')">
                <i class="fas fa-history"></i> Historial
            </button>
        </div>


        <!-- Tab Perfil -->
        <div id="profile" class="tab-content active">
            <div class="profile-card">
                <h2><i class="fas fa-user-circle"></i> Informaci√≥n del Paciente</h2>
                <form id="profileForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Completo:</label>
                            <input type="text" id="fullName" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha de Nacimiento:</label>
                            <input type="date" id="birthDate" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Peso (kg):</label>
                            <input type="number" id="weight" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label>Altura (cm):</label>
                            <input type="number" id="height" required>
                        </div>
                        <div class="form-group">
                            <label>Genero:</label>
                            <select id="gender" required>
                                <option value="">Seleccionar</option>
                                <option value="M">Masculino</option>
                                <option value="F">Femenino</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Condiciones medicas:</label>
                        <textarea id="conditions" rows="3" placeholder="Diabetes, hipertensi√≥n, medicamentos actuales..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Perfil
                    </button>
                </form>
            </div>

            <div id="profileSummary" style="display:none;">
                <h3><i class="fas fa-clipboard-list"></i> Resumen del Perfil</h3>
                <div id="profileDisplay"></div>
            </div>
        </div>

        <!-- Tab Registrar -->
        <div id="register" class="tab-content">
            <h2><i class="fas fa-plus-circle"></i> Registrar Nueva Medicion</h2>
            <form id="readingForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Fecha:</label>
                        <input type="date" id="readingDate" required>
                    </div>
                    <div class="form-group">
                        <label>Hora:</label>
                        <input type="time" id="readingTime" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>presion Sistolica (mmHg):</label>
                        <input type="number" id="systolic" min="70" max="300" required>
                    </div>
                    <div class="form-group">
                        <label>presion Diastolica (mmHg):</label>
                        <input type="number" id="diastolic" min="40" max="200" required>
                    </div>
                    <div class="form-group">
                        <label>Pulso (lpm):</label>
                        <input type="number" id="pulse" min="30" max="200" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notas:</label>
                    <textarea id="notes" rows="3" placeholder="Actividad previa, estado emocional, s√≠ntomas..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-chart-bar"></i> Registrar Medicion
                </button>
            </form>

            <div id="currentRisk" style="margin-top: 30px;"></div>
        </div>

        <!-- Tab Dashboard -->
        <div id="dashboard" class="tab-content">
            <h2><i class="fas fa-tachometer-alt"></i> Dashboard de An√°lisis</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="avgSystolic">--</div>
                    <div class="stat-label">Sistolica Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgDiastolic">--</div>
                    <div class="stat-label">Diastolica Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgPulse">--</div>
                    <div class="stat-label">Pulso Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalReadings">--</div>
                    <div class="stat-label">Total Mediciones</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Per√≠odo de An√°lisis:</label>
                    <select id="chartPeriod" onchange="updateCharts()">
                        <option value="week">ULTIMA Semana</option>
                        <option value="month">√öltimo Mes</option>
                        <option value="quarter" selected>√öltimos 3 Meses</option>
                        <option value="all">Todos los Registros</option>
                    </select>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="pressureChart"></canvas>
            </div>

            <div class="chart-container">
                <canvas id="pulseChart"></canvas>
            </div>

            <div class="recommendations">
                <h3><i class="fas fa-lightbulb"></i> Recomendaciones Personalizadas</h3>
                <div id="recommendations"></div>
            </div>
        </div>

        <!-- Tab Historial -->
        <div id="history" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2><i class="fas fa-history"></i> Historial de Mediciones</h2>
                <button class="btn btn-danger" onclick="clearAllData()">
                    <i class="fas fa-trash-alt"></i> Limpiar Datos
                </button>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Filtrar por Fecha:</label>
                    <input type="date" id="filterDate" onchange="filterHistory()">
                </div>
                <div class="form-group">
                    <label>Filtrar por Riesgo:</label>
                    <select id="filterRisk" onchange="filterHistory()">
                        <option value="">Todos los niveles</option>
                        <option value="Normal">Normal</option>
                        <option value="Elevada">Elevada</option>
                        <option value="Etapa 1">Hipertension Etapa 1</option>
                        <option value="Etapa 2">Hipertension Etapa 2</option>
                        <option value="Crisis">Crisis Hipertensiva</option>
                    </select>
                </div>
            </div>

            <div id="historyTable"></div>
        </div>
    </div>

    <script>
        // Variables globales
        let userData = {};
        let readings = [];
        let charts = {};

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setCurrentDateTime();
            setupEventListeners();
            updateDisplay();
        });

        function setupEventListeners() {
            document.getElementById('profileForm').addEventListener('submit', saveProfile);
            document.getElementById('readingForm').addEventListener('submit', saveReading);
        }

        function setCurrentDateTime() {
            const now = new Date();
            document.getElementById('readingDate').value = now.toISOString().split('T')[0];
            document.getElementById('readingTime').value = now.toTimeString().slice(0, 5);
        }

        // Gesti√≥n de pesta√±as
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                setTimeout(() => updateCharts(), 100);
            } else if (tabName === 'history') {
                displayHistory();
            }
        }

        // Gesti√≥n de datos
        function saveData() {
            const data = {
                userData: userData,
                readings: readings
            };
            localStorage.setItem('bloodPressureData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('bloodPressureData');
            if (saved) {
                const data = JSON.parse(saved);
                userData = data.userData || {};
                readings = data.readings || [];
                populateProfile();
            }
        }

        function populateProfile() {
            if (userData.fullName) {
                document.getElementById('fullName').value = userData.fullName || '';
                document.getElementById('birthDate').value = userData.birthDate || '';
                document.getElementById('weight').value = userData.weight || '';
                document.getElementById('height').value = userData.height || '';
                document.getElementById('gender').value = userData.gender || '';
                document.getElementById('conditions').value = userData.conditions || '';
                showProfileSummary();
            }
        }

        // Perfil del usuario
        function saveProfile(e) {
            e.preventDefault();
            userData = {
                fullName: document.getElementById('fullName').value,
                birthDate: document.getElementById('birthDate').value,
                weight: parseFloat(document.getElementById('weight').value),
                height: parseInt(document.getElementById('height').value),
                gender: document.getElementById('gender').value,
                conditions: document.getElementById('conditions').value
            };
            
            userData.age = calculateAge(userData.birthDate);
            userData.bmi = calculateBMI(userData.weight, userData.height);
            
            saveData();
            showProfileSummary();
            showAlert('success', '‚úÖ Perfil guardado correctamente');
        }

        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        function calculateBMI(weight, height) {
            const heightM = height / 100;
            return (weight / (heightM * heightM)).toFixed(1);
        }

        function showProfileSummary() {
            const summary = document.getElementById('profileSummary');
            const display = document.getElementById('profileDisplay');
            
            const bmiCategory = getBMICategory(userData.bmi);
            
            display.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${userData.age}</div>
                        <div class="stat-label">A√±os</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${userData.bmi}</div>
                        <div class="stat-label">IMC (${bmiCategory})</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${userData.weight}kg</div>
                        <div class="stat-label">Peso Actual</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${userData.height}cm</div>
                        <div class="stat-label">Altura</div>
                    </div>
                </div>
                <p><strong>Nombre:</strong> ${userData.fullName}</p>
                <p><strong>Genero:</strong> ${userData.gender === 'M' ? 'Masculino' : 'Femenino'}</p>
                <p><strong>Condiciones:</strong> ${userData.conditions || 'Ninguna registrada'}</p>
            `;
            summary.style.display = 'block';
        }

        function getBMICategory(bmi) {
            if (bmi < 18.5) return 'Bajo peso';
            if (bmi < 25) return 'Normal';
            if (bmi < 30) return 'Sobrepeso';
            return 'Obesidad';
        }

        // Registro de mediciones
        function saveReading(e) {
            e.preventDefault();
            
            const reading = {
                id: Date.now(),
                date: document.getElementById('readingDate').value,
                time: document.getElementById('readingTime').value,
                systolic: parseInt(document.getElementById('systolic').value),
                diastolic: parseInt(document.getElementById('diastolic').value),
                pulse: parseInt(document.getElementById('pulse').value),
                notes: document.getElementById('notes').value,
                timestamp: new Date().toISOString()
            };

            reading.category = categorizeBloodPressure(reading.systolic, reading.diastolic);
            reading.risk = getRiskLevel(reading.category);

            readings.unshift(reading);
            saveData();
            
            document.getElementById('readingForm').reset();
            setCurrentDateTime();
            
            showCurrentRisk(reading);
            showAlert('success', `‚úÖ Medicion registrada: ${reading.systolic}/${reading.diastolic} - ${reading.category}`);
            updateDisplay();
        }

        function categorizeBloodPressure(systolic, diastolic) {
            // Basado en las gu√≠as de la American Heart Association adaptadas para M√©xico
            if (systolic < 120 && diastolic < 80) return 'Normal';
            if (systolic >= 120 && systolic <= 129 && diastolic < 80) return 'Elevada';
            if ((systolic >= 130 && systolic <= 139) || (diastolic >= 80 && diastolic <= 89)) return 'Etapa 1';
            if (systolic >= 140 || diastolic >= 90) return 'Etapa 2';
            if (systolic > 180 || diastolic > 120) return 'Crisis';
            return 'Indeterminada';
        }

        function getRiskLevel(category) {
            const risks = {
                'Normal': 'risk-normal',
                'Elevada': 'risk-elevated',
                'Etapa 1': 'risk-stage1',
                'Etapa 2': 'risk-stage2',
                'Crisis': 'risk-crisis'
            };
            return risks[category] || 'risk-normal';
        }

        function showCurrentRisk(reading) {
            const container = document.getElementById('currentRisk');
            const recommendations = getRecommendations(reading.category, userData.age);
            
            container.innerHTML = `
                <div class="alert alert-${reading.category === 'Crisis' ? 'error' : reading.category === 'Normal' ? 'success' : 'warning'}">
                    <h3>üìä Resultado de la Medicion</h3>
                    <p><strong>presion:</strong> ${reading.systolic}/${reading.diastolic} mmHg</p>
                    <p><strong>Pulso:</strong> ${reading.pulse} lpm</p>
                    <p><strong>Categor√≠a:</strong> <span class="risk-indicator ${reading.risk}">${reading.category}</span></p>
                </div>
                <div class="recommendations">
                    <h4>üí° Recomendaciones</h4>
                    ${recommendations}
                </div>
            `;
        }

        function getRecommendations(category, age) {
            const baseRecommendations = {
                'Normal': `
                    <ul>
                        <li>üéâ ¬°Excelente! Tu presion arterial est√° en rango normal</li>
                        <li>ü•ó Mant√©n una dieta rica en frutas tropicales locales (papaya, mango, guan√°bana)</li>
                        <li>üèÉ‚Äç‚ôÄÔ∏è Contin√∫a con actividad f√≠sica regular, ideal nataci√≥n en el clima c√°lido</li>
                        <li>üíß Mant√©n hidratacion constante debido al clima h√∫medo de Quintana Roo</li>
                        <li>üìÖ Controla cada 6-12 meses</li>
                    </ul>
                `,
                'Elevada': `
                    <ul>
                        <li>‚ö†Ô∏è presion elevada - requiere atenci√≥n preventiva</li>
                        <li>üßÇ Reduce el consumo de sal, evita alimentos procesados</li>
                        <li>ü•• Incluye agua de coco natural para hidratacion y electrolitos</li>
                        <li>üö∂‚Äç‚ôÄÔ∏è Camina 30 minutos diarios, preferible temprano por la ma√±ana</li>
                        <li>üò¥ Duerme 7-8 horas con ventilaci√≥n adecuada</li>
                        <li>üìÖ Controla semanalmente</li>
                    </ul>
                `,
                'Etapa 1': `
                    <ul>
                        <li>üö® Hipertension Etapa 1 - consulta medica recomendada</li>
                        <li>ü©∫ Acude a tu centro de salud o IMSS m√°s cercano</li>
                        <li>ü•ó Dieta DASH adaptada: chaya, achiote, pescado fresco</li>
                        <li>üö´ Evita alcohol y tabaco completamente</li>
                        <li>üßò‚Äç‚ôÄÔ∏è Practica t√©cnicas de relajaci√≥n por el estr√©s del calor</li>
                        <li>üìÖ Controla 2-3 veces por semana</li>
                    </ul>
                `,
                'Etapa 2': `
                    <ul>
                        <li>üö® Hipertension Etapa 2 - REQUIERE ATENCI√ìN medica INMEDIATA</li>
                        <li>üè• Programa cita medica urgente en las pr√≥ximas 48 horas</li>
                        <li>üíä Posible necesidad de medicamentos antihipertensivos</li>
                        <li>üìä Monitoreo diario de presion arterial</li>
                        <li>üßÇ Dieta estricta baja en sodio (<2g/d√≠a)</li>
                        <li>üíß hidratacion controlada seg√∫n indicaci√≥n medica</li>
                    </ul>
                `,
                'Crisis': `
                    <ul>
                        <li>üö® CRISIS HIPERTENSIVA - EMERGENCIA medica</li>
                        <li>üöë BUSCA ATENCI√ìN medica INMEDIATA</li>
                        <li>üè• Acude al servicio de urgencias m√°s cercano</li>
                        <li>üìû Hospital General de Canc√∫n: (998) 884-6500</li>
                        <li>üìû Cruz Roja Quintana Roo: (998) 884-1616</li>
                        <li>‚ö†Ô∏è NO conduzcas, pide ayuda para trasladarte</li>
                    </ul>
                `
            };

            let recommendations = baseRecommendations[category] || baseRecommendations['Normal'];
            
            // Recomendaciones adicionales por edad
            if (age > 60) {
                recommendations += `
                    <p><strong>üë¥ Consideraciones para adulto mayor:</strong></p>
                    <ul>
                        <li>üå°Ô∏è Extra cuidado con la hidratacion en clima tropical</li>
                        <li>üíä Revisar interacciones medicamentosas</li>
                        <li>ü§ù Apoyo familiar para seguimiento medico</li>
                    </ul>
                `;
            }

            return recommendations;
        }

        // Dashboard y gr√°ficas
        function updateDisplay() {
            updateStats();
            updateCharts();
        }

        function updateStats() {
            if (readings.length === 0) {
                document.getElementById('avgSystolic').textContent = '--';
                document.getElementById('avgDiastolic').textContent = '--';
                document.getElementById('avgPulse').textContent = '--';
                document.getElementById('totalReadings').textContent = '0';
                return;
            }

            const avgSys = Math.round(readings.reduce((sum, r) => sum + r.systolic, 0) / readings.length);
            const avgDia = Math.round(readings.reduce((sum, r) => sum + r.diastolic, 0) / readings.length);
            const avgPulse = Math.round(readings.reduce((sum, r) => sum + r.pulse, 0) / readings.length);

            document.getElementById('avgSystolic').textContent = avgSys;
            document.getElementById('avgDiastolic').textContent = avgDia;
            document.getElementById('avgPulse').textContent = avgPulse;
            document.getElementById('totalReadings').textContent = readings.length;

            updateRecommendations(avgSys, avgDia);
        }

        function updateRecommendations(avgSys, avgDia) {
            const category = categorizeBloodPressure(avgSys, avgDia);
            const recommendations = document.getElementById('recommendations');
            const personalizedRecs = getRecommendations(category, userData.age || 30);
            
            recommendations.innerHTML = `
                <p><strong>Basado en tus promedios: ${avgSys}/${avgDia} mmHg</strong></p>
                <p><strong>Categor√≠a promedio:</strong> <span class="risk-indicator ${getRiskLevel(category)}">${category}</span></p>
                ${personalizedRecs}
            `;
        }

        function getFilteredReadings() {
            const period = document.getElementById('chartPeriod').value;
            const now = new Date();
            let startDate;

            switch (period) {
                case 'week':
                    startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    break;
                case 'month':
                    startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    break;
                case 'quarter':
                    startDate = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
                    break;
                default:
                    return [...readings].reverse();
            }

            return readings.filter(r => {
                const readingDate = new Date(r.date);
                return readingDate >= startDate;
            }).reverse();
        }

        function updateCharts() {
            const filteredReadings = getFilteredReadings();
            
            if (filteredReadings.length === 0) {
                return;
            }

            updatePressureChart(filteredReadings);
            updatePulseChart(filteredReadings);
        }

        function updatePressureChart(data) {
            const ctx = document.getElementById('pressureChart').getContext('2d');
            
            if (charts.pressure) {
                charts.pressure.destroy();
            }

            const labels = data.map(r => `${r.date} ${r.time.slice(0, 5)}`);
            
            charts.pressure = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sistolica',
                        data: data.map(r => r.systolic),
                        borderColor: '#dc2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }, {
                        label: 'Diastolica',
                        data: data.map(r => r.diastolic),
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evoluci√≥n de la presion Arterial',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 60,
                            max: 200,
                            title: {
                                display: true,
                                text: 'mmHg'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Fecha y Hora'
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 5,
                            hoverRadius: 8
                        }
                    }
                }
            });

            // A√±adir l√≠neas de referencia
            addReferenceLines();
        }

        function addReferenceLines() {
            const chart = charts.pressure;
            if (!chart) return;

            // L√≠neas de referencia para presion arterial normal
            chart.options.plugins.annotation = {
                annotations: {
                    systolicNormal: {
                        type: 'line',
                        yMin: 120,
                        yMax: 120,
                        borderColor: 'rgba(34, 197, 94, 0.7)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        label: {
                            enabled: true,
                            content: 'Sistolica Normal (120)',
                            position: 'end'
                        }
                    },
                    diastolicNormal: {
                        type: 'line',
                        yMin: 80,
                        yMax: 80,
                        borderColor: 'rgba(59, 130, 246, 0.7)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        label: {
                            enabled: true,
                            content: 'Diastolica Normal (80)',
                            position: 'end'
                        }
                    }
                }
            };
        }

        function updatePulseChart(data) {
            const ctx = document.getElementById('pulseChart').getContext('2d');
            
            if (charts.pulse) {
                charts.pulse.destroy();
            }

            const labels = data.map(r => `${r.date} ${r.time.slice(0, 5)}`);
            
            charts.pulse = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pulso (lpm)',
                        data: data.map(r => r.pulse),
                        borderColor: '#059669',
                        backgroundColor: 'rgba(5, 150, 105, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evoluci√≥n del Pulso',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 50,
                            max: 120,
                            title: {
                                display: true,
                                text: 'Latidos por minuto (lpm)'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Fecha y Hora'
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 5,
                            hoverRadius: 8
                        }
                    }
                }
            });
        }

        // Historial
        function displayHistory() {
            const container = document.getElementById('historyTable');
            
            if (readings.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        üìù No hay mediciones registradas a√∫n. ¬°Comienza registrando tu primera Medicion!
                    </div>
                `;
                return;
            }

            let filteredReadings = [...readings];
            
            // Aplicar filtros
            const dateFilter = document.getElementById('filterDate').value;
            const riskFilter = document.getElementById('filterRisk').value;

            if (dateFilter) {
                filteredReadings = filteredReadings.filter(r => r.date === dateFilter);
            }

            if (riskFilter) {
                filteredReadings = filteredReadings.filter(r => r.category === riskFilter);
            }

            const tableHTML = `
                <table class="readings-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Hora</th>
                            <th>Sistolica</th>
                            <th>Diastolica</th>
                            <th>Pulso</th>
                            <th>Categor√≠a</th>
                            <th>Notas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredReadings.map(reading => `
                            <tr>
                                <td>${formatDate(reading.date)}</td>
                                <td>${reading.time}</td>
                                <td><strong>${reading.systolic}</strong></td>
                                <td><strong>${reading.diastolic}</strong></td>
                                <td>${reading.pulse} lpm</td>
                                <td><span class="risk-indicator ${reading.risk}">${reading.category}</span></td>
                                <td>${reading.notes || '-'}</td>
                                <td>
                                    <button class="btn btn-danger" onclick="deleteReading(${reading.id})" style="padding: 5px 10px; font-size: 12px;">
                                        üóëÔ∏è Eliminar
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-MX', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function filterHistory() {
            displayHistory();
        }

        function deleteReading(id) {
            if (confirm('¬øEstas seguro de que quieres eliminar esta Medicion?')) {
                readings = readings.filter(r => r.id !== id);
                saveData();
                displayHistory();
                updateDisplay();
                showAlert('success', '‚úÖ Medicion eliminada correctamente');
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è ADVERTENCIA: Esto eliminar√° TODOS los datos (perfil y mediciones). ¬øEstas seguro?')) {
                if (confirm('üö® ULTIMA CONFIRMACION: Se borrar√°n todos los datos permanentemente. ¬øContinuar?')) {
                    localStorage.removeItem('bloodPressureData');
                    userData = {};
                    readings = [];
                    
                    // Limpiar formularios
                    document.getElementById('profileForm').reset();
                    document.getElementById('readingForm').reset();
                    document.getElementById('profileSummary').style.display = 'none';
                    
                    // Actualizar displays
                    updateDisplay();
                    displayHistory();
                    
                    showAlert('success', 'üóëÔ∏è Todos los datos han sido eliminados');
                }
            }
        }

        // Utilidades
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = message;
            
            // Insertar al inicio del contenido activo
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(alertDiv, activeTab.firstChild);
            
            // Eliminar despu√©s de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
            
            // Scroll suave hacia arriba
            alertDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Exportar datos (funci√≥n adicional)
        function exportData() {
            const data = {
                userData: userData,
                readings: readings,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `presion_arterial_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('success', 'üìÅ Datos exportados correctamente');
        }

        // Funci√≥n para importar datos
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.userData && importedData.readings) {
                        userData = importedData.userData;
                        readings = importedData.readings;
                        
                        saveData();
                        populateProfile();
                        updateDisplay();
                        displayHistory();
                        
                        showAlert('success', 'üìÅ Datos importados correctamente');
                    } else {
                        throw new Error('Formato de archivo inv√°lido');
                    }
                } catch (error) {
                    showAlert('error', '‚ùå Error al importar los datos. Verifica el formato del archivo.');
                }
            };
            reader.readAsText(file);
        }

        // A√±adir botones de exportar/importar al historial
        function addExportImportButtons() {
            const historyTab = document.getElementById('history');
            const buttonsHTML = `
                <div style="margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 10px;">
                    <h3>üìÅ Gesti√≥n de Datos</h3>
                    <button class="btn btn-primary" onclick="exportData()">üì§ Exportar Datos</button>
                    <input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display: none;">
                    <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">üì• Importar Datos</button>
                </div>
            `;
            
            const container = historyTab.querySelector('#historyTable');
            container.insertAdjacentHTML('afterend', buttonsHTML);
        }

        // Inicializar botones de exportar/importar cuando se carga la p√°gina
        setTimeout(() => {
            addExportImportButtons();
        }, 1000);
    </script>
</body>
</html>