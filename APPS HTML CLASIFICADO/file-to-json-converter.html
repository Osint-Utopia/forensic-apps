<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor a JSON Dataset</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--color-panel);
            backdrop-filter: blur(var(--blur));
            border-radius: var(--radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .header {
            background: var(--color-panel);
            backdrop-filter: blur(var(--blur));
            color: var(--color-text);
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            color: var(--color-accent);
            font-weight: 600;
        }

        .header p {
            color: var(--color-text);
            opacity: 0.8;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: var(--color-panel);
            backdrop-filter: blur(var(--blur));
            border-radius: var(--radius);
            border: 1px solid rgba(0,255,255,0.2);
            transition: var(--transition);
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,255,255,0.15);
        }

        .section h2 {
            color: var(--color-accent);
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 600;
        }

        .upload-area {
            border: 2px dashed rgba(0,255,255,0.4);
            border-radius: var(--radius);
            padding: 40px;
            text-align: center;
            background: rgba(0,255,255,0.03);
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-area:hover {
            background: rgba(0,255,255,0.08);
            border-color: var(--color-accent);
        }

        .upload-area.dragover {
            background: rgba(0,255,255,0.15);
            border-color: var(--color-accent);
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            background: var(--color-accent);
            color: #0d1117;
            border: none;
            padding: 12px 30px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: var(--transition);
            margin: 5px;
        }

        .btn:hover {
            background: #00c4cc;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,255,255,0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(0,255,255,0.2);
            color: var(--color-accent);
            border: 1px solid var(--color-accent);
        }

        .btn-secondary:hover {
            background: rgba(0,255,255,0.3);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--color-text);
            font-weight: 600;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(0,255,255,0.3);
            background: rgba(0,255,255,0.05);
            color: var(--color-text);
            border-radius: var(--radius);
            font-size: 14px;
            transition: var(--transition);
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--color-accent);
            background: rgba(0,255,255,0.1);
        }

        .output-area {
            background: #000000;
            color: var(--color-accent);
            padding: 20px;
            border-radius: var(--radius);
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid rgba(0,255,255,0.3);
        }

        .file-info {
            background: rgba(0,255,255,0.05);
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 15px;
            display: none;
            border: 1px solid rgba(0,255,255,0.2);
        }

        .file-info.show {
            display: block;
        }

        .status {
            padding: 10px;
            border-radius: var(--radius);
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
        }

        .status.success {
            background: rgba(0,210,106,0.2);
            color: var(--color-success);
            border: 1px solid var(--color-success);
        }

        .status.error {
            background: rgba(255,60,60,0.2);
            color: var(--color-error);
            border: 1px solid var(--color-error);
        }

        .status.info {
            background: rgba(0,255,255,0.2);
            color: var(--color-accent);
            border: 1px solid var(--color-accent);
        }

        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .tag {
            background: rgba(0,255,255,0.2);
            color: var(--color-accent);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid var(--color-accent);
        }

        .loader {
            border: 4px solid rgba(0,255,255,0.1);
            border-top: 4px solid var(--color-accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Conversor de Archivos a JSON</h1>
            <p>Convierte TXT, DOC, DOCX, PDF, CSV, XML a formato JSON para datasets</p>
        </div>

        <div class="content">
            <!-- Secci√≥n de carga de archivo -->
            <div class="section">
                <h2>1Ô∏è‚É£ Cargar Archivo</h2>
                <div class="upload-area" id="uploadArea">
                    <p style="font-size: 48px; margin-bottom: 10px;">üìÅ</p>
                    <p style="font-size: 18px; margin-bottom: 10px;">Arrastra y suelta tu archivo aqu√≠</p>
                    <p style="color: #666; margin-bottom: 20px;">o haz clic para seleccionar</p>
                    <button class="btn" onclick="document.getElementById('fileInput').click()">Seleccionar Archivo</button>
                    <input type="file" id="fileInput" accept=".txt,.doc,.docx,.pdf,.csv,.xml,.json">
                    <p style="color: #999; margin-top: 15px; font-size: 12px;">Formatos soportados: TXT, DOC, DOCX, PDF, CSV, XML, JSON</p>
                </div>
                <div class="file-info" id="fileInfo"></div>
            </div>

            <!-- Secci√≥n de etiquetas -->
            <div class="section">
                <h2>2Ô∏è‚É£ Configurar Etiquetas de Identificaci√≥n</h2>
                <div class="grid">
                    <div class="input-group">
                        <label>ID del Dataset:</label>
                        <input type="text" id="datasetId" placeholder="dataset_001">
                    </div>
                    <div class="input-group">
                        <label>Categor√≠a:</label>
                        <input type="text" id="category" placeholder="documentos, datos, textos...">
                    </div>
                    <div class="input-group">
                        <label>Fuente:</label>
                        <input type="text" id="source" placeholder="nombre del origen">
                    </div>
                    <div class="input-group">
                        <label>Idioma Original:</label>
                        <select id="language">
                            <option value="es">Espa√±ol</option>
                            <option value="en">Ingl√©s</option>
                            <option value="fr">Franc√©s</option>
                            <option value="de">Alem√°n</option>
                            <option value="pt">Portugu√©s</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label>Etiquetas Personalizadas (separadas por comas):</label>
                    <input type="text" id="customTags" placeholder="etiqueta1, etiqueta2, etiqueta3">
                </div>
            </div>

            <!-- Secci√≥n de traducci√≥n -->
            <div class="section">
                <h2>3Ô∏è‚É£ Opciones de Traducci√≥n</h2>
                <div class="input-group">
                    <label>
                        <input type="checkbox" id="translateOption" style="width: auto; margin-right: 10px;">
                        Traducir contenido del ingl√©s al espa√±ol
                    </label>
                </div>
                <div id="translationInfo" style="display: none; margin-top: 15px; padding: 15px; background: white; border-radius: 10px;">
                    <p style="color: #667eea; font-weight: bold;">‚ÑπÔ∏è Informaci√≥n:</p>
                    <p style="margin-top: 10px;">La traducci√≥n se realizar√° autom√°ticamente usando la API de Claude AI. El contenido en ingl√©s ser√° traducido al espa√±ol tradicional.</p>
                </div>
            </div>

            <!-- Secci√≥n de procesamiento -->
            <div class="section">
                <h2>4Ô∏è‚É£ Procesar y Convertir</h2>
                <button class="btn" onclick="processFile()">üîÑ Convertir a JSON</button>
                <button class="btn btn-secondary" onclick="downloadJSON()">üíæ Descargar JSON</button>
                <button class="btn btn-secondary" onclick="clearAll()">üóëÔ∏è Limpiar Todo</button>
                <div class="loader" id="loader"></div>
                <div id="status"></div>
            </div>

            <!-- Secci√≥n de resultado -->
            <div class="section">
                <h2>5Ô∏è‚É£ Resultado JSON</h2>
                <div class="output-area" id="output">// El JSON aparecer√° aqu√≠ despu√©s de procesar el archivo...</div>
            </div>
        </div>
    </div>

    <script>
        let currentFile = null;
        let jsonResult = null;

        // Configurar drag and drop
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        document.getElementById('translateOption').addEventListener('change', (e) => {
            document.getElementById('translationInfo').style.display = e.target.checked ? 'block' : 'none';
        });

        function handleFile(file) {
            currentFile = file;
            const fileInfo = document.getElementById('fileInfo');
            fileInfo.innerHTML = `
                <p><strong>üìÑ Archivo:</strong> ${file.name}</p>
                <p><strong>üìè Tama√±o:</strong> ${(file.size / 1024).toFixed(2)} KB</p>
                <p><strong>üìã Tipo:</strong> ${file.type || 'Desconocido'}</p>
            `;
            fileInfo.classList.add('show');
            showStatus('Archivo cargado correctamente. Configura las opciones y presiona "Convertir a JSON"', 'success');
        }

        async function processFile() {
            if (!currentFile) {
                showStatus('Por favor, selecciona un archivo primero', 'error');
                return;
            }

            showLoader(true);
            showStatus('Procesando archivo...', 'info');

            try {
                let content = await readFile(currentFile);
                
                // Si se solicita traducci√≥n y el idioma es ingl√©s
                if (document.getElementById('translateOption').checked && 
                    document.getElementById('language').value === 'en') {
                    content = await translateToSpanish(content);
                }

                // Crear objeto JSON con etiquetas
                jsonResult = createJSONDataset(content);
                
                // Mostrar resultado
                document.getElementById('output').textContent = JSON.stringify(jsonResult, null, 2);
                showStatus('‚úÖ Archivo convertido exitosamente a JSON', 'success');
            } catch (error) {
                showStatus('‚ùå Error al procesar el archivo: ' + error.message, 'error');
                console.error(error);
            } finally {
                showLoader(false);
            }
        }

        async function readFile(file) {
            const extension = file.name.split('.').pop().toLowerCase();
            
            switch(extension) {
                case 'txt':
                    return await readAsText(file);
                
                case 'csv':
                    return await readCSV(file);
                
                case 'xml':
                    return await readXML(file);
                
                case 'json':
                    return await readJSON(file);
                
                case 'pdf':
                    return await readPDF(file);
                
                case 'doc':
                case 'docx':
                    return await readDOCX(file);
                
                default:
                    throw new Error('Formato de archivo no soportado: ' + extension);
            }
        }

        function readAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        async function readCSV(file) {
            return new Promise((resolve, reject) => {
                Papa.parse(file, {
                    header: true,
                    complete: (results) => resolve(results.data),
                    error: reject
                });
            });
        }

        async function readXML(file) {
            const text = await readAsText(file);
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(text, "text/xml");
            return xmlToJson(xmlDoc);
        }

        function xmlToJson(xml) {
            let obj = {};
            if (xml.nodeType === 1) {
                if (xml.attributes.length > 0) {
                    obj["@attributes"] = {};
                    for (let j = 0; j < xml.attributes.length; j++) {
                        const attribute = xml.attributes.item(j);
                        obj["@attributes"][attribute.nodeName] = attribute.nodeValue;
                    }
                }
            } else if (xml.nodeType === 3) {
                obj = xml.nodeValue;
            }
            if (xml.hasChildNodes()) {
                for (let i = 0; i < xml.childNodes.length; i++) {
                    const item = xml.childNodes.item(i);
                    const nodeName = item.nodeName;
                    if (typeof obj[nodeName] === "undefined") {
                        obj[nodeName] = xmlToJson(item);
                    } else {
                        if (typeof obj[nodeName].push === "undefined") {
                            const old = obj[nodeName];
                            obj[nodeName] = [];
                            obj[nodeName].push(old);
                        }
                        obj[nodeName].push(xmlToJson(item));
                    }
                }
            }
            return obj;
        }

        async function readJSON(file) {
            const text = await readAsText(file);
            return JSON.parse(text);
        }

        async function readPDF(file) {
            // Nota: Para PDFs completos, necesitar√≠as PDF.js
            // Aqu√≠ una versi√≥n simplificada que lee como texto
            showStatus('‚ö†Ô∏è Extracci√≥n b√°sica de PDF (texto plano)', 'info');
            return await readAsText(file);
        }

        async function readDOCX(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const arrayBuffer = e.target.result;
                        const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
                        resolve(result.value);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        async function translateToSpanish(content) {
            showStatus('üåê Traduciendo contenido al espa√±ol...', 'info');
            
            try {
                const textToTranslate = typeof content === 'string' ? content : JSON.stringify(content);
                
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 4000,
                        messages: [
                            { 
                                role: "user", 
                                content: `Traduce el siguiente texto del ingl√©s al espa√±ol tradicional (de Espa√±a o M√©xico). Mant√©n el formato y estructura original. Si es JSON, mant√©n las claves en ingl√©s pero traduce los valores de texto:\n\n${textToTranslate}`
                            }
                        ],
                    })
                });

                const data = await response.json();
                const translatedText = data.content
                    .map(item => (item.type === "text" ? item.text : ""))
                    .filter(Boolean)
                    .join("\n");
                
                // Si el contenido original era JSON, intentar parsearlo de vuelta
                if (typeof content === 'object') {
                    try {
                        return JSON.parse(translatedText);
                    } catch {
                        return translatedText;
                    }
                }
                
                return translatedText;
            } catch (error) {
                showStatus('‚ö†Ô∏è No se pudo traducir. Se usar√° el contenido original.', 'info');
                console.error('Error en traducci√≥n:', error);
                return content;
            }
        }

        function createJSONDataset(content) {
            const now = new Date();
            const tags = document.getElementById('customTags').value
                .split(',')
                .map(t => t.trim())
                .filter(t => t.length > 0);

            return {
                metadata: {
                    dataset_id: document.getElementById('datasetId').value || `dataset_${now.getTime()}`,
                    created_at: now.toISOString(),
                    filename: currentFile.name,
                    file_size: currentFile.size,
                    file_type: currentFile.type || 'unknown',
                    category: document.getElementById('category').value || 'general',
                    source: document.getElementById('source').value || 'unknown',
                    language: document.getElementById('language').value,
                    translated: document.getElementById('translateOption').checked,
                    tags: tags,
                    version: "1.0"
                },
                data: content
            };
        }

        function downloadJSON() {
            if (!jsonResult) {
                showStatus('Primero debes procesar un archivo', 'error');
                return;
            }

            const dataStr = JSON.stringify(jsonResult, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${jsonResult.metadata.dataset_id}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus('üì• JSON descargado correctamente', 'success');
        }

        function clearAll() {
            currentFile = null;
            jsonResult = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').classList.remove('show');
            document.getElementById('output').textContent = '// El JSON aparecer√° aqu√≠ despu√©s de procesar el archivo...';
            document.getElementById('datasetId').value = '';
            document.getElementById('category').value = '';
            document.getElementById('source').value = '';
            document.getElementById('customTags').value = '';
            document.getElementById('translateOption').checked = false;
            document.getElementById('translationInfo').style.display = 'none';
            document.getElementById('status').innerHTML = '';
            showStatus('üîÑ Todo limpiado. Listo para nuevo archivo', 'info');
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function showLoader(show) {
            document.getElementById('loader').style.display = show ? 'block' : 'none';
        }
    </script>
</body>
</html>