<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSINT Tool v3.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Courier New', monospace; background: #0a0a0a; color: #00ff00; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        .section { background: #111; border: 1px solid #333; margin: 20px 0; padding: 20px; border-radius: 5px; }
        .input-group { margin: 15px 0; }
        .input-group label { display: block; margin-bottom: 5px; color: #888; }
        .input-group input, .input-group select, .input-group textarea { 
            width: 100%; padding: 8px; background: #222; border: 1px solid #555; color: #00ff00; border-radius: 3px; 
        }
        .btn { background: #333; border: 1px solid #555; color: #00ff00; padding: 10px 20px; cursor: pointer; border-radius: 3px; margin: 5px; }
        .btn:hover { background: #444; }
        .btn.danger { border-color: #ff0000; color: #ff0000; }
        .btn.success { border-color: #00ff00; color: #00ff00; }
        .results { background: #0a0a0a; border: 1px solid #333; padding: 15px; margin: 10px 0; border-radius: 3px; max-height: 400px; overflow-y: auto; }
        .status { color: #ffff00; font-size: 12px; }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .logs { background: #000; border: 1px solid #333; padding: 10px; height: 300px; overflow-y: auto; font-size: 12px; }
        .file-info { background: #1a1a1a; padding: 10px; margin: 5px 0; border-left: 3px solid #00ff00; }
        .url-item { background: #222; padding: 8px; margin: 5px 0; border-radius: 3px; }
        .url-item a { color: #00ffff; text-decoration: none; }
        .url-item a:hover { text-decoration: underline; }
        .progress { background: #333; height: 20px; border-radius: 3px; margin: 10px 0; }
        .progress-bar { background: #00ff00; height: 100%; border-radius: 3px; width: 0%; transition: width 0.3s; }
        .data-section { background: #0f0f0f; border: 1px solid #444; padding: 15px; margin: 10px 0; }
        .scraped-data { background: #1a0a0a; border-left: 3px solid #ff0000; padding: 10px; margin: 5px 0; font-size: 11px; }
        .meta-data { background: #0a1a0a; border-left: 3px solid #00ff00; padding: 10px; margin: 5px 0; font-size: 11px; }
        .tabs { display: flex; margin-bottom: 20px; }
        .tab { padding: 10px 20px; background: #222; border: 1px solid #555; cursor: pointer; }
        .tab.active { background: #333; color: #00ff00; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>OSINT Investigator v3.0</h1>
            <p>Open Source Intelligence Tool - Now with Real Scraping & Analysis</p>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('search')">Search & Scrape</div>
            <div class="tab" onclick="switchTab('analysis')">Data Analysis</div>
            <div class="tab" onclick="switchTab('export')">Export & Tools</div>
        </div>

        <!-- Search Tab -->
        <div id="search-tab" class="tab-content active">
            <div class="section">
                <h2>Target Configuration</h2>
                <div class="grid">
                    <div>
                        <div class="input-group">
                            <label>Primary Target:</label>
                            <input type="text" id="targetName" placeholder="John Doe">
                        </div>
                        <div class="input-group">
                            <label>Secondary Target (optional):</label>
                            <input type="text" id="targetName2" placeholder="Jane Smith">
                        </div>
                        <div class="input-group">
                            <label>Location/Context:</label>
                            <input type="text" id="targetLocation" placeholder="New York, Company XYZ">
                        </div>
                    </div>
                    <div>
                        <div class="input-group">
                            <label>Upload Image for Reverse Search:</label>
                            <input type="file" id="targetImage" accept="image/*">
                            <div id="imagePreview" style="margin-top: 10px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Search Engines & Methods</h2>
                <div class="grid-3">
                    <div>
                        <h3>Google Dorks</h3>
                        <label><input type="checkbox" id="basicSearch" checked> Basic Profile</label><br>
                        <label><input type="checkbox" id="socialSearch" checked> Social Media</label><br>
                        <label><input type="checkbox" id="docSearch"> Documents</label><br>
                        <label><input type="checkbox" id="emailSearch"> Email Hunt</label><br>
                        <label><input type="checkbox" id="phoneSearch"> Phone Search</label>
                    </div>
                    <div>
                        <h3>Reverse Image</h3>
                        <label><input type="checkbox" id="tineye" checked> TinEye</label><br>
                        <label><input type="checkbox" id="yandex" checked> Yandex Images</label><br>
                        <label><input type="checkbox" id="googleImg" checked> Google Images</label><br>
                        <label><input type="checkbox" id="bingImg"> Bing Images</label>
                    </div>
                    <div>
                        <h3>Data Extraction</h3>
                        <label><input type="checkbox" id="scrapeMode" checked> Auto Scrape</label><br>
                        <label><input type="checkbox" id="metaExtract" checked> Extract Metadata</label><br>
                        <label><input type="checkbox" id="socialExtract"> Social Links</label><br>
                        <label><input type="checkbox" id="phoneExtract"> Phone Numbers</label><br>
                        <label><input type="checkbox" id="emailExtract" checked> Email Addresses</label>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn success" onclick="startFullInvestigation()">üöÄ Start Investigation</button>
                    <button class="btn" onclick="openAllSearches()">üîç Open All Searches</button>
                    <button class="btn" onclick="startScraping()">üï∑Ô∏è Start Scraping</button>
                    <button class="btn danger" onclick="stopInvestigation()">‚èπÔ∏è Stop</button>
                </div>
            </div>

            <div class="section">
                <h2>Investigation Progress</h2>
                <div id="progressContainer">
                    <div class="progress">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div id="currentTask" class="status">Ready to start...</div>
                </div>
            </div>

            <div class="section">
                <h2>Live Results</h2>
                <div class="grid">
                    <div>
                        <h3>Generated URLs</h3>
                        <div id="urlResults" class="results">No URLs generated yet...</div>
                    </div>
                    <div>
                        <h3>Activity Log</h3>
                        <div id="activityLog" class="logs">System initialized...<br></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Tab -->
        <div id="analysis-tab" class="tab-content">
            <div class="section">
                <h2>Scraped Data Analysis</h2>
                <div class="grid">
                    <div>
                        <h3>Extracted Information</h3>
                        <div id="extractedData" class="results">No data extracted yet...</div>
                    </div>
                    <div>
                        <h3>Pattern Recognition</h3>
                        <div id="patternData" class="results">No patterns detected...</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Social Media Connections</h2>
                <div id="socialConnections" class="results">No connections found...</div>
            </div>

            <div class="section">
                <h2>Image Analysis Results</h2>
                <div id="imageAnalysis" class="results">No image analysis data...</div>
            </div>
        </div>

        <!-- Export Tab -->
        <div id="export-tab" class="tab-content">
            <div class="section">
                <h2>Export Options</h2>
                <div class="grid">
                    <div>
                        <h3>File Management</h3>
                        <button class="btn" onclick="exportJSON()">üìÑ Export JSON</button>
                        <button class="btn" onclick="exportCSV()">üìä Export CSV</button>
                        <button class="btn" onclick="exportHTML()">üåê Export HTML Report</button>
                        <button class="btn" onclick="loadInvestigation()">üìÅ Load Investigation</button>
                        <input type="file" id="loadFile" accept=".json" style="display: none;" onchange="handleFileLoad(this)">
                    </div>
                    <div>
                        <h3>Advanced Tools</h3>
                        <button class="btn" onclick="generateDorksList()">üìù Generate Custom Dorks</button>
                        <button class="btn" onclick="bulkImageSearch()">üñºÔ∏è Bulk Image Search</button>
                        <button class="btn" onclick="crossReference()">üîó Cross Reference Data</button>
                        <button class="btn" onclick="timelineAnalysis()">‚è∞ Timeline Analysis</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Investigation Summary</h2>
                <div id="investigationSummary" class="data-section">
                    <p>No investigation data available...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global investigation state
        let investigation = {
            target: {},
            urls: [],
            scrapedData: [],
            extractedData: {},
            progress: 0,
            isRunning: false,
            timestamp: null
        };

        let scrapingQueue = [];
        let currentScrapeIndex = 0;

        // Tab management
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Logging system
        function log(message, type = 'info') {
            const logElement = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff0000' : type === 'success' ? '#00ff00' : '#ffffff';
            logElement.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateProgress(percent, task) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('currentTask').textContent = task;
            investigation.progress = percent;
        }

        // Image handling
        document.getElementById('targetImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = 
                        `<img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border: 1px solid #555;">
                         <p style="font-size: 11px; color: #888;">Size: ${(file.size/1024).toFixed(1)}KB</p>`;
                    investigation.target.imageData = e.target.result;
                    log(`Image loaded: ${file.name}`);
                };
                reader.readAsDataURL(file);
            }
        });

        // Dork generation (improved)
        function generateDorks(name, name2 = '', location = '') {
            const dorks = [];
            const operators = ['AND', 'OR'];
            
            if (document.getElementById('basicSearch').checked) {
                dorks.push(`"${name}"`);
                if (location) dorks.push(`"${name}" "${location}"`);
                if (name2) dorks.push(`"${name}" "${name2}"`);
            }
            
            if (document.getElementById('socialSearch').checked) {
                const socialSites = ['linkedin.com', 'facebook.com', 'twitter.com', 'instagram.com'];
                socialSites.forEach(site => {
                    dorks.push(`"${name}" site:${site}`);
                    if (name2) dorks.push(`"${name}" "${name2}" site:${site}`);
                });
            }
            
            if (document.getElementById('docSearch').checked) {
                const fileTypes = ['pdf', 'doc', 'docx', 'xlsx'];
                fileTypes.forEach(type => {
                    dorks.push(`"${name}" filetype:${type}`);
                });
            }
            
            if (document.getElementById('emailSearch').checked) {
                dorks.push(`"${name}" "@gmail.com" OR "@yahoo.com" OR "@hotmail.com"`);
                dorks.push(`"${name}" email OR contact OR mail`);
            }
            
            if (document.getElementById('phoneSearch').checked) {
                dorks.push(`"${name}" phone OR telephone OR mobile`);
                dorks.push(`"${name}" "+1" OR "555" OR "phone:"`);
            }
            
            return dorks;
        }

        // URL generation
        function generateSearchUrls() {
            const name = document.getElementById('targetName').value.trim();
            const name2 = document.getElementById('targetName2').value.trim();
            const location = document.getElementById('targetLocation').value.trim();
            
            if (!name) return [];
            
            const urls = [];
            const dorks = generateDorks(name, name2, location);
            
            // Google searches
            dorks.forEach(dork => {
                urls.push({
                    type: 'google',
                    query: dork,
                    url: `https://www.google.com/search?q=${encodeURIComponent(dork)}`,
                    timestamp: new Date().toISOString()
                });
            });
            
            // Reverse image searches
            if (investigation.target.imageData) {
                if (document.getElementById('tineye').checked) {
                    urls.push({
                        type: 'tineye',
                        query: 'reverse_image',
                        url: 'https://tineye.com/',
                        note: 'Upload image manually',
                        timestamp: new Date().toISOString()
                    });
                }
                
                if (document.getElementById('yandex').checked) {
                    urls.push({
                        type: 'yandex',
                        query: 'reverse_image',
                        url: 'https://yandex.com/images/',
                        note: 'Upload image manually',
                        timestamp: new Date().toISOString()
                    });
                }
                
                if (document.getElementById('googleImg').checked) {
                    urls.push({
                        type: 'google_images',
                        query: 'reverse_image',
                        url: 'https://images.google.com/',
                        note: 'Upload image manually',
                        timestamp: new Date().toISOString()
                    });
                }
            }
            
            return urls;
        }

        // Scraping functions
        async function scrapeUrl(url) {
            const proxies = [
                'https://api.allorigins.win/get?url=',
                'https://cors-anywhere.herokuapp.com/',
                'https://api.codetabs.com/v1/proxy?quest='
            ];
            
            for (const proxy of proxies) {
                try {
                    const response = await fetch(proxy + encodeURIComponent(url.url));
                    const data = await response.json();
                    
                    let content = '';
                    if (data.contents) content = data.contents;
                    else if (data.body) content = data.body;
                    else content = JSON.stringify(data);
                    
                    return {
                        url: url.url,
                        content: content,
                        timestamp: new Date().toISOString(),
                        proxy: proxy,
                        success: true
                    };
                } catch (error) {
                    log(`Proxy ${proxy} failed: ${error.message}`, 'error');
                }
            }
            
            return {
                url: url.url,
                content: null,
                error: 'All proxies failed',
                success: false
            };
        }

        // Data extraction
        function extractDataFromContent(content, url) {
            if (!content) return {};
            
            const extracted = {
                emails: [],
                phones: [],
                socialLinks: [],
                metadata: {}
            };
            
            // Email extraction
            const emailRegex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g;
            const emails = content.match(emailRegex) || [];
            extracted.emails = [...new Set(emails)];
            
            // Phone extraction
            const phoneRegex = /(\+?1?[-.\s]?)?\(?([0-9]{3})\)?[-.\s]?([0-9]{3})[-.\s]?([0-9]{4})/g;
            const phones = content.match(phoneRegex) || [];
            extracted.phones = [...new Set(phones)];
            
            // Social links
            const socialRegex = /(facebook|twitter|instagram|linkedin|youtube|tiktok)\.com\/[a-zA-Z0-9._-]+/g;
            const socialLinks = content.match(socialRegex) || [];
            extracted.socialLinks = [...new Set(socialLinks)];
            
            // Basic metadata
            extracted.metadata = {
                contentLength: content.length,
                wordCount: content.split(/\s+/).length,
                extractedAt: new Date().toISOString(),
                sourceUrl: url
            };
            
            return extracted;
        }

        // Main functions
        async function startFullInvestigation() {
            if (investigation.isRunning) {
                log('Investigation already running!', 'error');
                return;
            }
            
            const name = document.getElementById('targetName').value.trim();
            if (!name) {
                log('Please enter a target name', 'error');
                return;
            }
            
            investigation.isRunning = true;
            investigation.timestamp = new Date().toISOString();
            investigation.target = {
                name: name,
                name2: document.getElementById('targetName2').value.trim(),
                location: document.getElementById('targetLocation').value.trim(),
                imageData: investigation.target.imageData
            };
            
            log('üöÄ Starting full investigation...', 'success');
            updateProgress(10, 'Generating search URLs...');
            
            // Generate URLs
            investigation.urls = generateSearchUrls();
            displayUrls();
            
            updateProgress(30, 'Opening searches...');
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Open searches
            if (investigation.urls.length > 0) {
                openAllSearches();
            }
            
            updateProgress(50, 'Starting scraping process...');
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Start scraping
            if (document.getElementById('scrapeMode').checked) {
                await startScraping();
            }
            
            updateProgress(100, 'Investigation completed');
            investigation.isRunning = false;
            log('‚úÖ Investigation completed', 'success');
        }

        function openAllSearches() {
            if (investigation.urls.length === 0) {
                investigation.urls = generateSearchUrls();
                displayUrls();
            }
            
            let opened = 0;
            investigation.urls.forEach((urlObj, index) => {
                setTimeout(() => {
                    window.open(urlObj.url, '_blank');
                    log(`Opened: ${urlObj.type} - ${urlObj.query}`);
                    opened++;
                    updateProgress(30 + (opened / investigation.urls.length) * 20, `Opening search ${opened}/${investigation.urls.length}`);
                }, index * 500);
            });
        }

        async function startScraping() {
            if (investigation.urls.length === 0) {
                log('No URLs to scrape', 'error');
                return;
            }
            
            log('üï∑Ô∏è Starting scraping process...', 'success');
            scrapingQueue = [...investigation.urls];
            currentScrapeIndex = 0;
            
            for (let i = 0; i < scrapingQueue.length; i++) {
                updateProgress(50 + (i / scrapingQueue.length) * 40, `Scraping ${i + 1}/${scrapingQueue.length}`);
                
                const result = await scrapeUrl(scrapingQueue[i]);
                investigation.scrapedData.push(result);
                
                if (result.success && result.content) {
                    const extracted = extractDataFromContent(result.content, result.url);
                    investigation.extractedData[result.url] = extracted;
                    
                    log(`‚úÖ Scraped: ${result.url.substring(0, 50)}...`);
                    updateAnalysisDisplay();
                } else {
                    log(`‚ùå Failed: ${result.url.substring(0, 50)}...`, 'error');
                }
                
                await new Promise(resolve => setTimeout(resolve, 2000)); // Rate limiting
            }
            
            log('üï∑Ô∏è Scraping completed', 'success');
        }

        function stopInvestigation() {
            investigation.isRunning = false;
            scrapingQueue = [];
            updateProgress(0, 'Investigation stopped');
            log('‚èπÔ∏è Investigation stopped by user', 'error');
        }

        // Display functions
        function displayUrls() {
            const container = document.getElementById('urlResults');
            if (investigation.urls.length === 0) {
                container.innerHTML = 'No URLs generated yet...';
                return;
            }
            
            let html = '';
            investigation.urls.forEach((urlObj, index) => {
                html += `
                    <div class="url-item">
                        <strong>${urlObj.type}:</strong> ${urlObj.query}<br>
                        <a href="${urlObj.url}" target="_blank">${urlObj.url}</a>
                        ${urlObj.note ? `<br><small style="color: #888;">${urlObj.note}</small>` : ''}
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function updateAnalysisDisplay() {
            // Update extracted data display
            const extractedContainer = document.getElementById('extractedData');
            let extractedHtml = '';
            
            Object.entries(investigation.extractedData).forEach(([url, data]) => {
                extractedHtml += `
                    <div class="meta-data">
                        <strong>URL:</strong> ${url.substring(0, 60)}...<br>
                        <strong>Emails:</strong> ${data.emails.join(', ') || 'None'}<br>
                        <strong>Phones:</strong> ${data.phones.join(', ') || 'None'}<br>
                        <strong>Social:</strong> ${data.socialLinks.join(', ') || 'None'}<br>
                        <small>Words: ${data.metadata.wordCount}, Size: ${data.metadata.contentLength}</small>
                    </div>
                `;
            });
            
            extractedContainer.innerHTML = extractedHtml || 'No data extracted yet...';
            
            // Update pattern recognition
            const patternContainer = document.getElementById('patternData');
            const allEmails = Object.values(investigation.extractedData).flatMap(data => data.emails);
            const allPhones = Object.values(investigation.extractedData).flatMap(data => data.phones);
            const allSocial = Object.values(investigation.extractedData).flatMap(data => data.socialLinks);
            
            const patterns = {
                uniqueEmails: [...new Set(allEmails)],
                uniquePhones: [...new Set(allPhones)],
                uniqueSocial: [...new Set(allSocial)]
            };
            
            patternContainer.innerHTML = `
                <div class="file-info">
                    <strong>Unique Emails Found:</strong> ${patterns.uniqueEmails.length}<br>
                    ${patterns.uniqueEmails.slice(0, 5).map(email => `‚Ä¢ ${email}`).join('<br>')}
                    ${patterns.uniqueEmails.length > 5 ? '<br>...' : ''}
                </div>
                <div class="file-info">
                    <strong>Unique Phones Found:</strong> ${patterns.uniquePhones.length}<br>
                    ${patterns.uniquePhones.slice(0, 5).map(phone => `‚Ä¢ ${phone}`).join('<br>')}
                    ${patterns.uniquePhones.length > 5 ? '<br>...' : ''}
                </div>
                <div class="file-info">
                    <strong>Social Links Found:</strong> ${patterns.uniqueSocial.length}<br>
                    ${patterns.uniqueSocial.slice(0, 5).map(social => `‚Ä¢ ${social}`).join('<br>')}
                    ${patterns.uniqueSocial.length > 5 ? '<br>...' : ''}
                </div>
            `;
        }

        // Export functions
        function exportJSON() {
            const data = {
                investigation: investigation,
                exportedAt: new Date().toISOString(),
                version: '3.0'
            };
            
            const filename = `osint_${investigation.target.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            
            log(`üìÑ Results exported as ${filename}`, 'success');
        }

        function exportCSV() {
            const rows = [['URL', 'Type', 'Emails', 'Phones', 'Social Links', 'Word Count']];
            
            Object.entries(investigation.extractedData).forEach(([url, data]) => {
                rows.push([
                    url,
                    investigation.urls.find(u => u.url === url)?.type || 'unknown',
                    data.emails.join('; '),
                    data.phones.join('; '),
                    data.socialLinks.join('; '),
                    data.metadata.wordCount
                ]);
            });
            
            const csvContent = rows.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `osint_${investigation.target.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            log('üìä CSV exported successfully', 'success');
        }

        function loadInvestigation() {
            document.getElementById('loadFile').click();
        }

        function handleFileLoad(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        investigation = data.investigation;
                        
                        // Populate form
                        document.getElementById('targetName').value = investigation.target.name || '';
                        document.getElementById('targetName2').value = investigation.target.name2 || '';
                        document.getElementById('targetLocation').value = investigation.target.location || '';
                        
                        // Update displays
                        displayUrls();
                        updateAnalysisDisplay();
                        
                        log(`üìÅ Investigation loaded from ${file.name}`, 'success');
                    } catch (error) {
                        log(`Error loading file: ${error.message}`, 'error');
                    }
                };
                reader.readAsText(file);
            }
        }

        // Advanced tools
        function exportHTML() {
            const htmlReport = `
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>OSINT Report - ${investigation.target.name}</title>
    <style>
        body { font-family: Arial; max-width: 1200px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .header { background: #333; color: white; padding: 20px; text-align: center; }
        .section { background: white; margin: 20px 0; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .data-item { background: #f9f9f9; padding: 10px; margin: 5px 0; border-left: 3px solid #007bff; }
        h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .timestamp { color: #888; font-size: 12px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>OSINT Investigation Report</h1>
        <p>Target: ${investigation.target.name}</p>
        <p class="timestamp">Generated: ${new Date().toLocaleString()}</p>
    </div>
    
    <div class="section">
        <h2>Investigation Summary</h2>
        <p><strong>Primary Target:</strong> ${investigation.target.name}</p>
        <p><strong>Secondary Target:</strong> ${investigation.target.name2 || 'N/A'}</p>
        <p><strong>Location/Context:</strong> ${investigation.target.location || 'N/A'}</p>
        <p><strong>URLs Searched:</strong> ${investigation.urls.length}</p>
        <p><strong>Pages Scraped:</strong> ${investigation.scrapedData.length}</p>
        <p><strong>Started:</strong> ${investigation.timestamp}</p>
    </div>
    
    <div class="section">
        <h2>Search URLs Generated</h2>
        ${investigation.urls.map(url => `
            <div class="data-item">
                <strong>${url.type}:</strong> ${url.query}<br>
                <a href="${url.url}" target="_blank">${url.url}</a>
            </div>
        `).join('')}
    </div>
    
    <div class="section">
        <h2>Extracted Data</h2>
        ${Object.entries(investigation.extractedData).map(([url, data]) => `
            <div class="data-item">
                <strong>Source:</strong> ${url}<br>
                <strong>Emails:</strong> ${data.emails.join(', ') || 'None found'}<br>
                <strong>Phones:</strong> ${data.phones.join(', ') || 'None found'}<br>
                <strong>Social Links:</strong> ${data.socialLinks.join(', ') || 'None found'}<br>
                <small>Content length: ${data.metadata.contentLength} chars, ${data.metadata.wordCount} words</small>
            </div>
        `).join('')}
    </div>
    
    <div class="section">
        <h2>Pattern Analysis</h2>
        ${(() => {
            const allEmails = Object.values(investigation.extractedData).flatMap(data => data.emails);
            const allPhones = Object.values(investigation.extractedData).flatMap(data => data.phones);
            const allSocial = Object.values(investigation.extractedData).flatMap(data => data.socialLinks);
            
            return `
                <div class="data-item">
                    <strong>Unique Emails Found:</strong> ${[...new Set(allEmails)].length}<br>
                    ${[...new Set(allEmails)].map(email => `‚Ä¢ ${email}`).join('<br>')}
                </div>
                <div class="data-item">
                    <strong>Unique Phones Found:</strong> ${[...new Set(allPhones)].length}<br>
                    ${[...new Set(allPhones)].map(phone => `‚Ä¢ ${phone}`).join('<br>')}
                </div>
                <div class="data-item">
                    <strong>Social Media Accounts:</strong> ${[...new Set(allSocial)].length}<br>
                    ${[...new Set(allSocial)].map(social => `‚Ä¢ ${social}`).join('<br>')}
                </div>
            `;
        })()}
    </div>
</body>
</html>`;
            
            const blob = new Blob([htmlReport], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `osint_report_${investigation.target.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            
            log('üåê HTML report generated', 'success');
        }

        function generateDorksList() {
            const name = document.getElementById('targetName').value.trim();
            if (!name) {
                log('Enter a target name first', 'error');
                return;
            }
            
            const customDorks = [
                // Advanced dorks
                `"${name}" intitle:"resume" OR intitle:"cv"`,
                `"${name}" inurl:about OR inurl:profile`,
                `"${name}" site:github.com OR site:gitlab.com`,
                `"${name}" site:medium.com OR site:dev.to`,
                `"${name}" "email" OR "contact" OR "reach"`,
                `"${name}" intext:"phone" OR intext:"mobile"`,
                `"${name}" site:linkedin.com/in/`,
                `"${name}" (facebook.com OR twitter.com OR instagram.com)`,
                `"${name}" filetype:pdf CV OR resume`,
                `"${name}" "work at" OR "works at" OR "employed"`,
                `"${name}" site:*.edu`,
                `"${name}" "conference" OR "speaker" OR "presentation"`,
                `"${name}" site:youtube.com`,
                `"${name}" "@gmail.com" OR "@yahoo.com" OR "@outlook.com"`,
                `related:linkedin.com/in/${name.replace(/\s+/g, '-').toLowerCase()}`
            ];
            
            let dorkHtml = '<div class="section"><h3>Custom Dorks Generated</h3>';
            customDorks.forEach((dork, index) => {
                const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(dork)}`;
                dorkHtml += `
                    <div class="url-item">
                        ${index + 1}. ${dork}<br>
                        <a href="${searchUrl}" target="_blank">Search Now</a>
                    </div>
                `;
            });
            dorkHtml += '</div>';
            
            document.getElementById('investigationSummary').innerHTML = dorkHtml;
            switchTab('export');
            log(`Generated ${customDorks.length} custom dorks`, 'success');
        }

        function bulkImageSearch() {
            if (!investigation.target.imageData) {
                log('Upload an image first', 'error');
                return;
            }
            
            const imageSearchEngines = [
                { name: 'TinEye', url: 'https://tineye.com/' },
                { name: 'Yandex', url: 'https://yandex.com/images/' },
                { name: 'Google Images', url: 'https://images.google.com/' },
                { name: 'Bing Visual', url: 'https://www.bing.com/visualsearch' },
                { name: 'Baidu Images', url: 'https://image.baidu.com/' },
                { name: 'PimEyes', url: 'https://pimeyes.com/' }
            ];
            
            log('Opening bulk image search engines...', 'success');
            
            imageSearchEngines.forEach((engine, index) => {
                setTimeout(() => {
                    window.open(engine.url, '_blank');
                    log(`Opened ${engine.name}`);
                }, index * 1000);
            });
            
            alert('Upload the image manually to each search engine that opened.\nInstructions:\n1. TinEye: Click upload and select your image\n2. Yandex: Click camera icon\n3. Google: Click camera icon\n4. Bing: Click camera icon\n5. Baidu: Click camera icon\n6. PimEyes: Upload and search');
        }

        function crossReference() {
            const allEmails = Object.values(investigation.extractedData).flatMap(data => data.emails);
            const allPhones = Object.values(investigation.extractedData).flatMap(data => data.phones);
            const allSocial = Object.values(investigation.extractedData).flatMap(data => data.socialLinks);
            
            const uniqueEmails = [...new Set(allEmails)];
            const uniquePhones = [...new Set(allPhones)];
            const uniqueSocial = [...new Set(allSocial)];
            
            // Cross-reference analysis
            const crossRef = {
                emailDomains: {},
                phoneAreaCodes: {},
                socialPlatforms: {},
                connections: []
            };
            
            // Analyze email domains
            uniqueEmails.forEach(email => {
                const domain = email.split('@')[1];
                if (domain) {
                    crossRef.emailDomains[domain] = (crossRef.emailDomains[domain] || 0) + 1;
                }
            });
            
            // Analyze phone area codes
            uniquePhones.forEach(phone => {
                const areaCode = phone.match(/\d{3}/)?.[0];
                if (areaCode) {
                    crossRef.phoneAreaCodes[areaCode] = (crossRef.phoneAreaCodes[areaCode] || 0) + 1;
                }
            });
            
            // Analyze social platforms
            uniqueSocial.forEach(link => {
                const platform = link.match(/(facebook|twitter|instagram|linkedin|youtube|tiktok)/)?.[0];
                if (platform) {
                    crossRef.socialPlatforms[platform] = (crossRef.socialPlatforms[platform] || 0) + 1;
                }
            });
            
            // Find connections
            Object.entries(investigation.extractedData).forEach(([url, data]) => {
                if (data.emails.length > 0 && data.phones.length > 0) {
                    crossRef.connections.push({
                        source: url,
                        emails: data.emails,
                        phones: data.phones
                    });
                }
            });
            
            // Display results
            let html = '<div class="section"><h3>Cross-Reference Analysis</h3>';
            
            html += '<div class="data-item"><h4>Email Domain Distribution</h4>';
            Object.entries(crossRef.emailDomains).forEach(([domain, count]) => {
                html += `${domain}: ${count}<br>`;
            });
            html += '</div>';
            
            html += '<div class="data-item"><h4>Phone Area Code Distribution</h4>';
            Object.entries(crossRef.phoneAreaCodes).forEach(([code, count]) => {
                html += `${code}: ${count}<br>`;
            });
            html += '</div>';
            
            html += '<div class="data-item"><h4>Social Platform Distribution</h4>';
            Object.entries(crossRef.socialPlatforms).forEach(([platform, count]) => {
                html += `${platform}: ${count}<br>`;
            });
            html += '</div>';
            
            html += '<div class="data-item"><h4>Connected Data Points</h4>';
            crossRef.connections.forEach((conn, index) => {
                html += `<strong>Connection ${index + 1}:</strong><br>`;
                html += `Source: ${conn.source.substring(0, 50)}...<br>`;
                html += `Emails: ${conn.emails.join(', ')}<br>`;
                html += `Phones: ${conn.phones.join(', ')}<br><br>`;
            });
            html += '</div></div>';
            
            document.getElementById('investigationSummary').innerHTML = html;
            switchTab('export');
            log('Cross-reference analysis completed', 'success');
        }

        function timelineAnalysis() {
            const timeline = [];
            
            // Add URL generation events
            investigation.urls.forEach(url => {
                timeline.push({
                    timestamp: url.timestamp,
                    type: 'search',
                    description: `Generated ${url.type} search: ${url.query}`,
                    data: url
                });
            });
            
            // Add scraping events
            investigation.scrapedData.forEach(scraped => {
                timeline.push({
                    timestamp: scraped.timestamp,
                    type: scraped.success ? 'scrape_success' : 'scrape_fail',
                    description: scraped.success ? `Successfully scraped: ${scraped.url.substring(0, 50)}` : `Failed to scrape: ${scraped.url.substring(0, 50)}`,
                    data: scraped
                });
            });
            
            // Add extraction events
            Object.entries(investigation.extractedData).forEach(([url, data]) => {
                timeline.push({
                    timestamp: data.metadata.extractedAt,
                    type: 'extraction',
                    description: `Extracted data from: ${url.substring(0, 50)}`,
                    data: data
                });
            });
            
            // Sort by timestamp
            timeline.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            // Display timeline
            let html = '<div class="section"><h3>Investigation Timeline</h3>';
            
            timeline.forEach((event, index) => {
                const color = event.type === 'search' ? '#007bff' : 
                             event.type === 'scrape_success' ? '#28a745' : 
                             event.type === 'scrape_fail' ? '#dc3545' : '#ffc107';
                
                html += `
                    <div class="data-item" style="border-left-color: ${color};">
                        <strong>${index + 1}. ${event.type.toUpperCase()}</strong><br>
                        <small class="timestamp">${new Date(event.timestamp).toLocaleString()}</small><br>
                        ${event.description}
                    </div>
                `;
            });
            
            html += '</div>';
            
            document.getElementById('investigationSummary').innerHTML = html;
            switchTab('export');
            log(`Timeline generated with ${timeline.length} events`, 'success');
        }

        // Auto-save functionality
        setInterval(() => {
            if (investigation.isRunning) {
                const autoSave = {
                    investigation: investigation,
                    autoSaved: new Date().toISOString()
                };
                localStorage.setItem('osint_autosave', JSON.stringify(autoSave));
            }
        }, 30000); // Auto-save every 30 seconds

        // Load auto-save on startup
        window.addEventListener('load', () => {
            const autoSave = localStorage.getItem('osint_autosave');
            if (autoSave) {
                try {
                    const data = JSON.parse(autoSave);
                    const autoSaveTime = new Date(data.autoSaved);
                    const now = new Date();
                    const diffMinutes = (now - autoSaveTime) / 1000 / 60;
                    
                    if (diffMinutes < 60) {
                        if (confirm(`Found auto-saved investigation from ${autoSaveTime.toLocaleString()}. Load it?`)) {
                            investigation = data.investigation;
                            displayUrls();
                            updateAnalysisDisplay();
                            log('Auto-saved investigation loaded', 'success');
                        }
                    }
                } catch (error) {
                    log('Error loading auto-save', 'error');
                }
            }
        });

        // Initialize
        log('OSINT Investigator v3.0 initialized');
        log('Features: Scraping, Data Extraction, Cross-Reference, Timeline Analysis');
        updateProgress(0, 'Ready to start investigation...');
    </script>
</body>
</html>