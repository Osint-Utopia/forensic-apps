<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Presi√≥n Arterial</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
<style>
    * {
      margin : 0;
      padding : 0;
      box-sizing : border-box;
    }
    body {
      font-family : 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      background : #f5f6f5;
      min-height : 100vh;
      padding : 20px;
      line-height : 1.5;
      color : #1f2a44;
    }
    .container {
      max-width : 1280px;
      margin : 0 auto;
      background : #ffffff;
      border-radius : 12px;
      box-shadow : 0 4px 24px rgba(0, 0, 0, 0.08);
      border : 1px solid rgba(0, 0, 0, 0.05);
      overflow : hidden;
    }
    .header {
      background : #1f2a44;
      color : #ffffff;
      padding : 32px;
      text-align : center;
      position : relative;
    }
    .header h1 {
      font-size : 2.25rem;
      font-weight : 600;
      margin-bottom : 12px;
    }
    .header p {
      font-size : 1rem;
      opacity : 0.9;
      font-weight : 300;
    }
    .nav-tabs {
      display : flex;
      background : #f8f9fa;
      border-bottom : 1px solid #e0e4e8;
    }
    .nav-tab {
      flex : 1;
      padding : 16px;
      background : none;
      border : none;
      cursor : pointer;
      font-size : 1rem;
      font-weight : 500;
      color : #4b5563;
      transition : all 0.2s ease;
      position : relative;
    }
      .nav-tab : :after {
      content : '';
      position : absolute;
      bottom : 0;
      left : 0;
      width : 0;
      height : 2px;
      background : #1f2a44;
      transition : width 0.3s ease;
    }
      .nav-tab : hover : :after, .nav-tab.active : :after {
      width : 100%;
    }
    .nav-tab.active {
      color : #1f2a44;
      font-weight : 600;
    }
      .nav-tab : hover {
      background : rgba(31, 42, 68, 0.05);
    }
    .tab-content {
      display : none;
      padding : 24px;
      min-height : 360px;
      animation : fadeIn 0.3s ease;
    }
    .tab-content.active {
      display : block;
    }
    @keyframes fadeIn {
      from{opacity : 0;
    }
    to {
      opacity : 1;
    }
    }.form-group {
      margin-bottom : 20px;
    }
    .form-row {
      display : grid;
      grid-template-columns : repeat(auto-fit, minmax(300px, 1fr));
      gap : 24px;
      margin-bottom : 20px;
    }
    label {
      display : block;
      margin-bottom : 6px;
      font-weight : 500;
      color : #374151;
      font-size : 0.875rem;
    }
    input, select, textarea {
      width : 100%;
      padding : 12px 16px;
      border : 1px solid #d1d5db;
      border-radius : 8px;
      font-size : 1rem;
      transition : all 0.2s ease;
      background : #ffffff;
      font-family : inherit;
    }
      input : focus, select : focus, textarea : focus {
      outline : none;
      border-color : #1f2a44;
      box-shadow : 0 0 0 3px rgba(31, 42, 68, 0.1);
    }
    .btn {
      padding : 12px 24px;
      border : none;
      border-radius : 8px;
      font-size : 1rem;
      font-weight : 500;
      cursor : pointer;
      transition : all 0.2s ease;
      display : inline-flex;
      align-items : center;
      gap : 8px;
      font-family : inherit;
    }
    .btn-primary {
      background : #1f2a44;
      color : #ffffff;
    }
      .btn-primary : hover {
      background : #2d3a5c;
      transform : translateY(-1px);
    }
    .btn-danger {
      background : #b91c1c;
      color : #ffffff;
    }
      .btn-danger : hover {
      background : #991b1b;
      transform : translateY(-1px);
    }
    .stats-grid {
      display : grid;
      grid-template-columns : repeat(auto-fit, minmax(240px, 1fr));
      gap : 20px;
      margin-bottom : 24px;
    }
    .stat-card {
      background : #ffffff;
      border : 1px solid #e0e4e8;
      padding : 24px;
      border-radius : 12px;
      text-align : center;
      box-shadow : 0 2px 12px rgba(0, 0, 0, 0.05);
      transition : all 0.2s ease;
    }
      .stat-card : hover {
      transform : translateY(-2px);
      box-shadow : 0 4px 16px rgba(0, 0, 0, 0.08);
    }
    .stat-value {
      font-size : 2rem;
      font-weight : 600;
      margin-bottom : 8px;
    }
    .stat-label {
      font-size : 0.875rem;
      color : #6b7280;
    }
    .chart-container {
      background : #ffffff;
      border-radius : 12px;
      padding : 24px;
      box-shadow : 0 2px 12px rgba(0, 0, 0, 0.05);
      border : 1px solid #e0e4e8;
      margin-bottom : 24px;
    }
    .readings-table {
      width : 100%;
      border-collapse : collapse;
      background : #ffffff;
      border-radius : 12px;
      overflow : hidden;
      box-shadow : 0 2px 12px rgba(0, 0, 0, 0.05);
    }
    .readings-table th, .readings-table td {
      padding : 16px;
      text-align : left;
      border-bottom : 1px solid #e0e4e8;
    }
    .readings-table th {
      background : #f8f9fa;
      font-weight : 600;
      color : #374151;
      font-size : 0.75rem;
      text-transform : uppercase;
    }
      .readings-table tbody tr : hover {
      background : rgba(31, 42, 68, 0.03);
    }
    .risk-indicator {
      padding : 6px 12px;
      border-radius : 9999px;
      font-size : 0.75rem;
      font-weight : 600;
      text-align : center;
      text-transform : uppercase;
    }
    .risk-normal {
      background : #e6f4ea;
      color : #15803d;
    }
    .risk-elevated {
      background : #fef3c7;
      color : #92400e;
    }
    .risk-stage1 {
      background : #fee2e2;
      color : #991b1b;
    }
    .risk-stage2 {
      background : #fecaca;
      color : #7f1d1d;
    }
    .risk-crisis {
      background : #dc2626;
      color : #ffffff;
    }
    .profile-card {
      background : #ffffff;
      border-radius : 12px;
      padding : 24px;
      margin-bottom : 20px;
      box-shadow : 0 2px 12px rgba(0, 0, 0, 0.05);
      border : 1px solid #e0e4e8;
    }
    .recommendations {
      background : #f8f9fa;
      border-left : 4px solid #1f2a44;
      padding : 20px;
      border-radius : 0 8px 8px 0;
      margin : 20px 0;
      box-shadow : 0 2px 12px rgba(0, 0, 0, 0.05);
    }
    .alert {
      padding : 16px;
      border-radius : 8px;
      margin-bottom : 20px;
      font-weight : 500;
    }
    .alert-success {
      background : #e6f4ea;
      color : #15803d;
      border : 1px solid #a7f3d0;
    }
    .alert-warning {
      background : #fef3c7;
      color : #92400e;
      border : 1px solid #fde68a;
    }
    .alert-error {
      background : #fee2e2;
      color : #991b1b;
      border : 1px solid #fecaca;
    }
      @media (max-width : 768px) {
      body{padding : 10px;
    }
    .container {
      border-radius : 8px;
    }
    .header {
      padding : 20px;
    }
    .header h1 {
      font-size : 1.875rem;
    }
    .nav-tabs {
      flex-wrap : wrap;
    }
    .nav-tab {
      flex : 1 1 calc(50% - 4px);
      font-size : 0.875rem;
      padding : 12px;
    }
    .tab-content {
      padding : 16px;
    }
    .form-row {
      grid-template-columns : 1fr;
    }
    .stats-grid {
      grid-template-columns : 1fr;
    }
    .chart-container {
      padding : 16px;
    }
    .readings-table th, .readings-table td {
      padding : 12px;
      font-size : 0.875rem;
    }
    .btn {
      padding : 10px 16px;
      font-size : 0.875rem;
      width : 100%;
      justify-content : center;
    }
      }@media (max-width : 480px) {
      .nav-tab{flex : 1 1 100%;
      font-size : 0.8125rem;
    }
    .header h1 {
      font-size : 1.5rem;
    }
    .stat-value {
      font-size : 1.75rem;
    }
      } : :-webkit-scrollbar {
      width : 6px;
    }
      : : -webkit-scrollbar-track {
      background : #f1f5f9;
      border-radius : 3px;
    }
      : : -webkit-scrollbar-thumb {
      background : #9ca3af;
      border-radius : 3px;
    }
      : : -webkit-scrollbar-thumb : hover {
      background : #6b7280;
    }
    .stat-card {
      padding : 20px 15px;
    }
</style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-heartbeat"></i> Monitor de Presi√≥n Arterial</h1>
            <p><i class="fas fa-map-marker-alt"></i> Sistema integral de control para la Tia mas Chula</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('profile')">
                <i class="fas fa-user"></i> Perfil
            </button>
            <button class="nav-tab" onclick="showTab('register')">
                <i class="fas fa-plus-circle"></i> Registrar
            </button>
            <button class="nav-tab" onclick="showTab('dashboard')">
                <i class="fas fa-chart-line"></i> Dashboard
            </button>
            <button class="nav-tab" onclick="showTab('history')">
                <i class="fas fa-history"></i> Historial
            </button>
        </div>
            <button class="nav-tab active" onclick="showTab('profile')">üë§ Perfil</button>
            <button class="nav-tab" onclick="showTab('register')">üìù Registrar</button>
            <button class="nav-tab" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('history')">üìã Historial</button>
        </div>

        <!-- Tab Perfil -->
        <div id="profile" class="tab-content active">
            <div class="profile-card">
                <h2>üë§ Informaci√≥n del Paciente</h2>
                <form id="profileForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Completo:</label>
                            <input type="text" id="fullName" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha de Nacimiento:</label>
                            <input type="date" id="birthDate" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Peso (kg):</label>
                            <input type="number" id="weight" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label>Altura (cm):</label>
                            <input type="number" id="height" required>
                        </div>
                        <div class="form-group">
                            <label>G√©nero:</label>
                            <select id="gender" required>
                                <option value="">Seleccionar</option>
                                <option value="M">Masculino</option>
                                <option value="F">Femenino</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Condiciones M√©dicas:</label>
                        <textarea id="conditions" rows="3" placeholder="Diabetes, hipertensi√≥n, medicamentos actuales..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ Guardar Perfil</button>
                </form>
            </div>

            <div id="profileSummary" style="display:none;">
                <h3>üìã Resumen del Perfil</h3>
                <div id="profileDisplay"></div>
            </div>
        </div>

        <!-- Tab Registrar -->
        <div id="register" class="tab-content">
            <h2>üìù Registrar Nueva Medici√≥n</h2>
            <form id="readingForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Fecha:</label>
                        <input type="date" id="readingDate" required>
                    </div>
                    <div class="form-group">
                        <label>Hora:</label>
                        <input type="time" id="readingTime" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Presi√≥n Sist√≥lica (mmHg):</label>
                        <input type="number" id="systolic" min="70" max="300" required>
                    </div>
                    <div class="form-group">
                        <label>Presi√≥n Diast√≥lica (mmHg):</label>
                        <input type="number" id="diastolic" min="40" max="200" required>
                    </div>
                    <div class="form-group">
                        <label>Pulso (lpm):</label>
                        <input type="number" id="pulse" min="30" max="200" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notas:</label>
                    <textarea id="notes" rows="3" placeholder="Actividad previa, estado emocional, s√≠ntomas..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">üìä Registrar Medici√≥n</button>
            </form>

            <div id="currentRisk" style="margin-top: 30px;"></div>
        </div>

        <!-- Tab Dashboard -->
        <div id="dashboard" class="tab-content">
            <h2>üìä Dashboard de An√°lisis</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="avgSystolic">--</div>
                    <div class="stat-label">Sist√≥lica Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgDiastolic">--</div>
                    <div class="stat-label">Diast√≥lica Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgPulse">--</div>
                    <div class="stat-label">Pulso Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalReadings">--</div>
                    <div class="stat-label">Total Mediciones</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Per√≠odo de An√°lisis:</label>
                    <select id="chartPeriod" onchange="updateCharts()">
                        <option value="week">√öltima Semana</option>
                        <option value="month">√öltimo Mes</option>
                        <option value="quarter" selected>√öltimos 3 Meses</option>
                        <option value="all">Todos los Registros</option>
                    </select>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="pressureChart"></canvas>
            </div>

            <div class="chart-container">
                <canvas id="pulseChart"></canvas>
            </div>

            <div class="recommendations">
                <h3>üí° Recomendaciones Personalizadas</h3>
                <div id="recommendations"></div>
            </div>
        </div>

        <!-- Tab Historial -->
        <div id="history" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üìã Historial de Mediciones</h2>
                <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Limpiar Datos</button>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Filtrar por Fecha:</label>
                    <input type="date" id="filterDate" onchange="filterHistory()">
                </div>
                <div class="form-group">
                    <label>Filtrar por Riesgo:</label>
                    <select id="filterRisk" onchange="filterHistory()">
                        <option value="">Todos los niveles</option>
                        <option value="Normal">Normal</option>
                        <option value="Elevada">Elevada</option>
                        <option value="Etapa 1">Hipertensi√≥n Etapa 1</option>
                        <option value="Etapa 2">Hipertensi√≥n Etapa 2</option>
                        <option value="Crisis">Crisis Hipertensiva</option>
                    </select>
                </div>
            </div>

            <div id="historyTable"></div>
        </div>
    </div>

    <script>
        // Variables globales
        let userData = {};
        let readings = [];
        let charts = {};

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setCurrentDateTime();
            setupEventListeners();
            updateDisplay();
        });

        function setupEventListeners() {
            document.getElementById('profileForm').addEventListener('submit', saveProfile);
            document.getElementById('readingForm').addEventListener('submit', saveReading);
        }

        function setCurrentDateTime() {
            const now = new Date();
            document.getElementById('readingDate').value = now.toISOString().split('T')[0];
            document.getElementById('readingTime').value = now.toTimeString().slice(0, 5);
        }

        // Gesti√≥n de pesta√±as
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                setTimeout(() => updateCharts(), 100);
            } else if (tabName === 'history') {
                displayHistory();
            }
        }

        // Gesti√≥n de datos
        function saveData() {
            const data = {
                userData: userData,
                readings: readings
            };
            localStorage.setItem('bloodPressureData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('bloodPressureData');
            if (saved) {
                const data = JSON.parse(saved);
                userData = data.userData || {};
                readings = data.readings || [];
                populateProfile();
            }
        }

        function populateProfile() {
            if (userData.fullName) {
                document.getElementById('fullName').value = userData.fullName || '';
                document.getElementById('birthDate').value = userData.birthDate || '';
                document.getElementById('weight').value = userData.weight || '';
                document.getElementById('height').value = userData.height || '';
                document.getElementById('gender').value = userData.gender || '';
                document.getElementById('conditions').value = userData.conditions || '';
                showProfileSummary();
            }
        }

        // Perfil del usuario
        function saveProfile(e) {
            e.preventDefault();
            userData = {
                fullName: document.getElementById('fullName').value,
                birthDate: document.getElementById('birthDate').value,
                weight: parseFloat(document.getElementById('weight').value),
                height: parseInt(document.getElementById('height').value),
                gender: document.getElementById('gender').value,
                conditions: document.getElementById('conditions').value
            };
            
            userData.age = calculateAge(userData.birthDate);
            userData.bmi = calculateBMI(userData.weight, userData.height);
            
            saveData();
            showProfileSummary();
            showAlert('success', '‚úÖ Perfil guardado correctamente');
        }

        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        function calculateBMI(weight, height) {
            const heightM = height / 100;
            return (weight / (heightM * heightM)).toFixed(1);
        }

        function showProfileSummary() {
            const summary = document.getElementById('profileSummary');
            const display = document.getElementById('profileDisplay');
            
            const bmiCategory = getBMICategory(userData.bmi);
            
            display.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${userData.age}</div>
                        <div class="stat-label">A√±os</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${userData.bmi}</div>
                        <div class="stat-label">IMC (${bmiCategory})</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${userData.weight}kg</div>
                        <div class="stat-label">Peso Actual</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${userData.height}cm</div>
                        <div class="stat-label">Altura</div>
                    </div>
                </div>
                <p><strong>Nombre:</strong> ${userData.fullName}</p>
                <p><strong>G√©nero:</strong> ${userData.gender === 'M' ? 'Masculino' : 'Femenino'}</p>
                <p><strong>Condiciones:</strong> ${userData.conditions || 'Ninguna registrada'}</p>
            `;
            summary.style.display = 'block';
        }

        function getBMICategory(bmi) {
            if (bmi < 18.5) return 'Bajo peso';
            if (bmi < 25) return 'Normal';
            if (bmi < 30) return 'Sobrepeso';
            return 'Obesidad';
        }

        // Registro de mediciones
        function saveReading(e) {
            e.preventDefault();
            
            const reading = {
                id: Date.now(),
                date: document.getElementById('readingDate').value,
                time: document.getElementById('readingTime').value,
                systolic: parseInt(document.getElementById('systolic').value),
                diastolic: parseInt(document.getElementById('diastolic').value),
                pulse: parseInt(document.getElementById('pulse').value),
                notes: document.getElementById('notes').value,
                timestamp: new Date().toISOString()
            };

            reading.category = categorizeBloodPressure(reading.systolic, reading.diastolic);
            reading.risk = getRiskLevel(reading.category);

            readings.unshift(reading);
            saveData();
            
            document.getElementById('readingForm').reset();
            setCurrentDateTime();
            
            showCurrentRisk(reading);
            showAlert('success', `‚úÖ Medici√≥n registrada: ${reading.systolic}/${reading.diastolic} - ${reading.category}`);
            updateDisplay();
        }

        function categorizeBloodPressure(systolic, diastolic) {
            // Basado en las gu√≠as de la American Heart Association adaptadas para M√©xico
            if (systolic < 120 && diastolic < 80) return 'Normal';
            if (systolic >= 120 && systolic <= 129 && diastolic < 80) return 'Elevada';
            if ((systolic >= 130 && systolic <= 139) || (diastolic >= 80 && diastolic <= 89)) return 'Etapa 1';
            if (systolic >= 140 || diastolic >= 90) return 'Etapa 2';
            if (systolic > 180 || diastolic > 120) return 'Crisis';
            return 'Indeterminada';
        }

        function getRiskLevel(category) {
            const risks = {
                'Normal': 'risk-normal',
                'Elevada': 'risk-elevated',
                'Etapa 1': 'risk-stage1',
                'Etapa 2': 'risk-stage2',
                'Crisis': 'risk-crisis'
            };
            return risks[category] || 'risk-normal';
        }

        function showCurrentRisk(reading) {
            const container = document.getElementById('currentRisk');
            const recommendations = getRecommendations(reading.category, userData.age);
            
            container.innerHTML = `
                <div class="alert alert-${reading.category === 'Crisis' ? 'error' : reading.category === 'Normal' ? 'success' : 'warning'}">
                    <h3>üìä Resultado de la Medici√≥n</h3>
                    <p><strong>Presi√≥n:</strong> ${reading.systolic}/${reading.diastolic} mmHg</p>
                    <p><strong>Pulso:</strong> ${reading.pulse} lpm</p>
                    <p><strong>Categor√≠a:</strong> <span class="risk-indicator ${reading.risk}">${reading.category}</span></p>
                </div>
                <div class="recommendations">
                    <h4>üí° Recomendaciones</h4>
                    ${recommendations}
                </div>
            `;
        }

        function getRecommendations(category, age) {
            const baseRecommendations = {
                'Normal': `
                    <ul>
                        <li>üéâ ¬°Excelente! Tu presi√≥n arterial est√° en rango normal</li>
                        <li>ü•ó Mant√©n una dieta rica en frutas tropicales locales (papaya, mango, guan√°bana)</li>
                        <li>üèÉ‚Äç‚ôÄÔ∏è Contin√∫a con actividad f√≠sica regular, ideal nataci√≥n en el clima c√°lido</li>
                        <li>üíß Mant√©n hidrataci√≥n constante debido al clima h√∫medo de Quintana Roo</li>
                        <li>üìÖ Controla cada 6-12 meses</li>
                    </ul>
                `,
                'Elevada': `
                    <ul>
                        <li>‚ö†Ô∏è Presi√≥n elevada - requiere atenci√≥n preventiva</li>
                        <li>üßÇ Reduce el consumo de sal, evita alimentos procesados</li>
                        <li>ü•• Incluye agua de coco natural para hidrataci√≥n y electrolitos</li>
                        <li>üö∂‚Äç‚ôÄÔ∏è Camina 30 minutos diarios, preferible temprano por la ma√±ana</li>
                        <li>üò¥ Duerme 7-8 horas con ventilaci√≥n adecuada</li>
                        <li>üìÖ Controla semanalmente</li>
                    </ul>
                `,
                'Etapa 1': `
                    <ul>
                        <li>üö® Hipertensi√≥n Etapa 1 - consulta m√©dica recomendada</li>
                        <li>ü©∫ Acude a tu centro de salud o IMSS m√°s cercano</li>
                        <li>ü•ó Dieta DASH adaptada: chaya, achiote, pescado fresco</li>
                        <li>üö´ Evita alcohol y tabaco completamente</li>
                        <li>üßò‚Äç‚ôÄÔ∏è Practica t√©cnicas de relajaci√≥n por el estr√©s del calor</li>
                        <li>üìÖ Controla 2-3 veces por semana</li>
                    </ul>
                `,
                'Etapa 2': `
                    <ul>
                        <li>üö® Hipertensi√≥n Etapa 2 - REQUIERE ATENCI√ìN M√âDICA INMEDIATA</li>
                        <li>üè• Programa cita m√©dica urgente en las pr√≥ximas 48 horas</li>
                        <li>üíä Posible necesidad de medicamentos antihipertensivos</li>
                        <li>üìä Monitoreo diario de presi√≥n arterial</li>
                        <li>üßÇ Dieta estricta baja en sodio (<2g/d√≠a)</li>
                        <li>üíß Hidrataci√≥n controlada seg√∫n indicaci√≥n m√©dica</li>
                    </ul>
                `,
                'Crisis': `
                    <ul>
                        <li>üö® CRISIS HIPERTENSIVA - EMERGENCIA M√âDICA</li>
                        <li>üöë BUSCA ATENCI√ìN M√âDICA INMEDIATA</li>
                        <li>üè• Acude al servicio de urgencias m√°s cercano</li>
                        <li>üìû Hospital General de Canc√∫n: (998) 884-6500</li>
                        <li>üìû Cruz Roja Quintana Roo: (998) 884-1616</li>
                        <li>‚ö†Ô∏è NO conduzcas, pide ayuda para trasladarte</li>
                    </ul>
                `
            };

            let recommendations = baseRecommendations[category] || baseRecommendations['Normal'];
            
            // Recomendaciones adicionales por edad
            if (age > 60) {
                recommendations += `
                    <p><strong>üë¥ Consideraciones para adulto mayor:</strong></p>
                    <ul>
                        <li>üå°Ô∏è Extra cuidado con la hidrataci√≥n en clima tropical</li>
                        <li>üíä Revisar interacciones medicamentosas</li>
                        <li>ü§ù Apoyo familiar para seguimiento m√©dico</li>
                    </ul>
                `;
            }

            return recommendations;
        }

        // Dashboard y gr√°ficas
        function updateDisplay() {
            updateStats();
            updateCharts();
        }

        function updateStats() {
            if (readings.length === 0) {
                document.getElementById('avgSystolic').textContent = '--';
                document.getElementById('avgDiastolic').textContent = '--';
                document.getElementById('avgPulse').textContent = '--';
                document.getElementById('totalReadings').textContent = '0';
                return;
            }

            const avgSys = Math.round(readings.reduce((sum, r) => sum + r.systolic, 0) / readings.length);
            const avgDia = Math.round(readings.reduce((sum, r) => sum + r.diastolic, 0) / readings.length);
            const avgPulse = Math.round(readings.reduce((sum, r) => sum + r.pulse, 0) / readings.length);

            document.getElementById('avgSystolic').textContent = avgSys;
            document.getElementById('avgDiastolic').textContent = avgDia;
            document.getElementById('avgPulse').textContent = avgPulse;
            document.getElementById('totalReadings').textContent = readings.length;

            updateRecommendations(avgSys, avgDia);
        }

        function updateRecommendations(avgSys, avgDia) {
            const category = categorizeBloodPressure(avgSys, avgDia);
            const recommendations = document.getElementById('recommendations');
            const personalizedRecs = getRecommendations(category, userData.age || 30);
            
            recommendations.innerHTML = `
                <p><strong>Basado en tus promedios: ${avgSys}/${avgDia} mmHg</strong></p>
                <p><strong>Categor√≠a promedio:</strong> <span class="risk-indicator ${getRiskLevel(category)}">${category}</span></p>
                ${personalizedRecs}
            `;
        }

        function getFilteredReadings() {
            const period = document.getElementById('chartPeriod').value;
            const now = new Date();
            let startDate;

            switch (period) {
                case 'week':
                    startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    break;
                case 'month':
                    startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    break;
                case 'quarter':
                    startDate = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
                    break;
                default:
                    return [...readings].reverse();
            }

            return readings.filter(r => {
                const readingDate = new Date(r.date);
                return readingDate >= startDate;
            }).reverse();
        }

        function updateCharts() {
            const filteredReadings = getFilteredReadings();
            
            if (filteredReadings.length === 0) {
                return;
            }

            updatePressureChart(filteredReadings);
            updatePulseChart(filteredReadings);
        }

        function updatePressureChart(data) {
            const ctx = document.getElementById('pressureChart').getContext('2d');
            
            if (charts.pressure) {
                charts.pressure.destroy();
            }

            const labels = data.map(r => `${r.date} ${r.time.slice(0, 5)}`);
            
            charts.pressure = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sist√≥lica',
                        data: data.map(r => r.systolic),
                        borderColor: '#dc2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }, {
                        label: 'Diast√≥lica',
                        data: data.map(r => r.diastolic),
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evoluci√≥n de la Presi√≥n Arterial',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 60,
                            max: 200,
                            title: {
                                display: true,
                                text: 'mmHg'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Fecha y Hora'
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 5,
                            hoverRadius: 8
                        }
                    }
                }
            });

            // A√±adir l√≠neas de referencia
            addReferenceLines();
        }

        function addReferenceLines() {
            const chart = charts.pressure;
            if (!chart) return;

            // L√≠neas de referencia para presi√≥n arterial normal
            chart.options.plugins.annotation = {
                annotations: {
                    systolicNormal: {
                        type: 'line',
                        yMin: 120,
                        yMax: 120,
                        borderColor: 'rgba(34, 197, 94, 0.7)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        label: {
                            enabled: true,
                            content: 'Sist√≥lica Normal (120)',
                            position: 'end'
                        }
                    },
                    diastolicNormal: {
                        type: 'line',
                        yMin: 80,
                        yMax: 80,
                        borderColor: 'rgba(59, 130, 246, 0.7)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        label: {
                            enabled: true,
                            content: 'Diast√≥lica Normal (80)',
                            position: 'end'
                        }
                    }
                }
            };
        }

        function updatePulseChart(data) {
            const ctx = document.getElementById('pulseChart').getContext('2d');
            
            if (charts.pulse) {
                charts.pulse.destroy();
            }

            const labels = data.map(r => `${r.date} ${r.time.slice(0, 5)}`);
            
            charts.pulse = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pulso (lpm)',
                        data: data.map(r => r.pulse),
                        borderColor: '#059669',
                        backgroundColor: 'rgba(5, 150, 105, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evoluci√≥n del Pulso',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 50,
                            max: 120,
                            title: {
                                display: true,
                                text: 'Latidos por minuto (lpm)'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Fecha y Hora'
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 5,
                            hoverRadius: 8
                        }
                    }
                }
            });
        }

        // Historial
        function displayHistory() {
            const container = document.getElementById('historyTable');
            
            if (readings.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        üìù No hay mediciones registradas a√∫n. ¬°Comienza registrando tu primera medici√≥n!
                    </div>
                `;
                return;
            }

            let filteredReadings = [...readings];
            
            // Aplicar filtros
            const dateFilter = document.getElementById('filterDate').value;
            const riskFilter = document.getElementById('filterRisk').value;

            if (dateFilter) {
                filteredReadings = filteredReadings.filter(r => r.date === dateFilter);
            }

            if (riskFilter) {
                filteredReadings = filteredReadings.filter(r => r.category === riskFilter);
            }

            const tableHTML = `
                <table class="readings-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Hora</th>
                            <th>Sist√≥lica</th>
                            <th>Diast√≥lica</th>
                            <th>Pulso</th>
                            <th>Categor√≠a</th>
                            <th>Notas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredReadings.map(reading => `
                            <tr>
                                <td>${formatDate(reading.date)}</td>
                                <td>${reading.time}</td>
                                <td><strong>${reading.systolic}</strong></td>
                                <td><strong>${reading.diastolic}</strong></td>
                                <td>${reading.pulse} lpm</td>
                                <td><span class="risk-indicator ${reading.risk}">${reading.category}</span></td>
                                <td>${reading.notes || '-'}</td>
                                <td>
                                    <button class="btn btn-danger" onclick="deleteReading(${reading.id})" style="padding: 5px 10px; font-size: 12px;">
                                        üóëÔ∏è Eliminar
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-MX', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function filterHistory() {
            displayHistory();
        }

        function deleteReading(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta medici√≥n?')) {
                readings = readings.filter(r => r.id !== id);
                saveData();
                displayHistory();
                updateDisplay();
                showAlert('success', '‚úÖ Medici√≥n eliminada correctamente');
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è ADVERTENCIA: Esto eliminar√° TODOS los datos (perfil y mediciones). ¬øEst√°s seguro?')) {
                if (confirm('üö® √öLTIMA CONFIRMACI√ìN: Se borrar√°n todos los datos permanentemente. ¬øContinuar?')) {
                    localStorage.removeItem('bloodPressureData');
                    userData = {};
                    readings = [];
                    
                    // Limpiar formularios
                    document.getElementById('profileForm').reset();
                    document.getElementById('readingForm').reset();
                    document.getElementById('profileSummary').style.display = 'none';
                    
                    // Actualizar displays
                    updateDisplay();
                    displayHistory();
                    
                    showAlert('success', 'üóëÔ∏è Todos los datos han sido eliminados');
                }
            }
        }

        // Utilidades
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = message;
            
            // Insertar al inicio del contenido activo
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(alertDiv, activeTab.firstChild);
            
            // Eliminar despu√©s de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
            
            // Scroll suave hacia arriba
            alertDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Exportar datos (funci√≥n adicional)
        function exportData() {
            const data = {
                userData: userData,
                readings: readings,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `presion_arterial_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('success', 'üìÅ Datos exportados correctamente');
        }

        // Funci√≥n para importar datos
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.userData && importedData.readings) {
                        userData = importedData.userData;
                        readings = importedData.readings;
                        
                        saveData();
                        populateProfile();
                        updateDisplay();
                        displayHistory();
                        
                        showAlert('success', 'üìÅ Datos importados correctamente');
                    } else {
                        throw new Error('Formato de archivo inv√°lido');
                    }
                } catch (error) {
                    showAlert('error', '‚ùå Error al importar los datos. Verifica el formato del archivo.');
                }
            };
            reader.readAsText(file);
        }

        // A√±adir botones de exportar/importar al historial
        function addExportImportButtons() {
            const historyTab = document.getElementById('history');
            const buttonsHTML = `
                <div style="margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 10px;">
                    <h3>üìÅ Gesti√≥n de Datos</h3>
                    <button class="btn btn-primary" onclick="exportData()">üì§ Exportar Datos</button>
                    <input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display: none;">
                    <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">üì• Importar Datos</button>
                </div>
            `;
            
            const container = historyTab.querySelector('#historyTable');
            container.insertAdjacentHTML('afterend', buttonsHTML);
        }

        // Inicializar botones de exportar/importar cuando se carga la p√°gina
        setTimeout(() => {
            addExportImportButtons();
        }, 1000);
    </script>
</body>
</html>